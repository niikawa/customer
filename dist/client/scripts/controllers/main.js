var mainCtrl=angular.module("mainCtrl",["CustomerServices","AzureServices"]);mainCtrl.controller("MainCtrl",["$scope","Shared","Customer","Azure","Utility",function(a,b,c,d,e){function f(){a.customerList=[],a.approch=[],a.customer=[],a.rank="",a.selectedCustomer={},a.lineLabel="",a.addStyle="",a.legendLabel=[],a.isGetData=!1}a.initialize=function(){a._construct(),f(),c.resource.get().$promise.then(function(b){a.customerList=b.data})},a.custmoerChangeExecute=function(){a.$emit("requestStart"),c.resource.detail({id:a.selectedCustomer.Id}).$promise.then(function(b){a.customer=b.customer,a.approch=b.approch,a.rank=a.approch[0].name,a.addStyle="two-row";var c=e.diffMonth(b.customer.last_purchasing_date,b.customer.start_purchasing_date);a.customer.frequency_avg=Math.round(10*b.customer.frequency/c)/10,a.customer.monetary_avg=Math.round(b.customer.monetary/c),a.customer.last_purchasing_date=e.formatString(a.customer.last_purchasing_date,"YYYY年MM月DD日"),a.lineLabel="直近1年の売上推移（月別サマリ）",a.legendLabel=[a.selectedCustomer.customer_id,"ランク平均"],a.orders=[b.orders,b.orders_avg],a.$emit("requestEnd"),a.isGetData=!0})},a.recomender=function(){a.$emit("requestStart"),d.resource.recomender({id:a.selectedCustomer.Id}).$promise.then(function(b){if(a.$emit("requestEnd"),""===b.data)e.successSticky("おすすめ商品はありません");else{var c=b.data[0];delete c[0],e.successSticky(c.join())}})}}]);