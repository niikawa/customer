var userControlCtrl=angular.module("userControlCtrl",["UesrServices","RoleServices"]);userControlCtrl.controller("UserControlCtrl",["$scope","$routeParams","User","Role","Utility","Shared","Location",function(a,b,c,d,e,f,g){function h(){if(a.user={},a.pageTitle=k.title,a.showPassword=!0,a.passwordEdit={show:"1"},a.pageType=k.type,2===k.type){a.passwordEdit.show="0",a.showPassword=!1;var d=parseInt(b.id,10);c.resource.get({id:d}).$promise.then(function(b){a.user=b.data[0],a.user.password_confirm=a.user.password})}}function i(){a.validators={password:{same:function(b,c){var d=b||c,e=a.user||{};return d!=e.name}},password_confirm:{confirm:function(b,c){var d=a.user||{},e=b||c;return e==d.password}},selected_role:{role:function(){var b=a.roleList||{},c=!1;return angular.forEach(b,function(a){a.isPush&&(c=!0)}),c}}},a.asyncValidators={mailaddress:{same:function(b,d){var e=b||d;return void 0===e||0===e.length?!0:c.validators.isSameMailAddress(a.user.user_id,e)}}}}function j(b){angular.forEach(b,function(b){b.isPush&&(a.user.role_id=b.role_id)})}var k=c.getPageProp(b.id);a.initialize=function(){f.setRoot("user control"),a._construct(),h(),i(),d.resource.get().$promise.then(function(b){a.roleList=b.data}),1===a.passwordEdit&&(a.$watch("user.name",function(){a.userForm.password.$validate()}),a.$watch("user.password",function(){a.userForm.password_confirm.$validate()})),a.$watch("roleList",function(){a.userForm.selected_role.$validate()},!0)},a.save=function(){j(a.roleList);var b=a.user.name+"さんの情報を保存しました";2===k.type?(e.deleteCommonInfo(a.user),"1"!==a.passwordEdit.show&&(delete a.user.password_confirm,delete a.user.password),c.resource.save({id:a.user.user_id,data:a.user}).$promise.then(function(){e.successSticky(b),g.user()})):c.resource.create({data:a.user}).$promise.then(function(){e.successSticky(b),g.user()})},a.isSameMailAddress=function(){a.userForm.mailaddress.$validate()}}]);