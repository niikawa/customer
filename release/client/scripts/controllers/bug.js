var bugCtrl=angular.module("bugCtrl",["BugServices"]);bugCtrl.controller("BugCtrl",["$rootScope","$scope","$sce","Upload","Shared","Bug","Modal","Utility",function(a,b,c,d,e,f,g,h){function i(){b.bug={resolve:0,type:null}}function j(){k()}function k(){f.resource.getByConditon(b.bug).$promise.then(function(a){b.isBugShow=a.data.length>0,b.isBugShow&&(f.addViewInfo(a.data),b.bugList=a.data,b.roleId=a.role)})}function l(a){b.selectedFile.push(a[0])}function m(){if(0!==b.modalParam.newComment.length){var c={demand_bug_id:b.modalParam.id,comment:b.modalParam.newComment};null!==b.modalParam.files?(a.$broadcast("requestStart"),f.commentSaveAndUpload(b.modalParam.files,c,function(c){b.modalInstance.close(),null!==c&&h.error(c),k(),a.$broadcast("requestEnd")})):f.resource.saveComment(c).$promise.then(function(){b.modalInstance.close(),k()})}}b.selectedFile=[],b.initialize=function(){b._construct(),i(),j()},b.show=function(){b.modalParam={type:"",title:"",contents:"",category:"",categoryList:f.categoryList,files:null},b.modalInstance=g.open(b,"partials/modal/send.html")},b.apology=function(){h.info("障害ですか。。。<br>すみません！")},b.getByCondition=function(){k()},b.resolve=function(a){var c=b.bugList[a].title;f.resource.resolve({id:b.bugList[a].id}).$promise.then(function(){h.info(c+"<br>を解決しました。"),b.bugList[a].resolve_name="解決",k()})},b.save=function(){var c={type:b.modalParam.type,title:b.modalParam.title,contents:b.modalParam.contents,category:b.modalParam.category.type};null!==b.modalParam.files?(a.$broadcast("requestStart"),f.saveAndUpload(b.modalParam.files,c,function(c){b.modalInstance.close(),null!==c&&h.error(c),k(),a.$broadcast("requestEnd")})):f.resource.save(c).$promise.then(function(){h.info("ありがとございました。"),b.modalInstance.close(),k()})},b.showComment=function(a){b.modalParam={execute:m,onFileSelect:l,files:null,newComment:"",id:b.bugList[a].id},b.modalInstance=g.open(b,"partials/modal/comment.html")},b.showCommentView=function(a){f.resource.getComment({id:b.bugList[a].id}).$promise.then(function(c){b.bugList[a].comments=c.data})},b.vote=function(a){f.resource.vote({id:b.bugList[a].id}).$promise.then(function(){k()})},b.download=function(a){return null===a||void 0===a?!1:void f.resource.download({id:a}).$promise.then(function(){b.modalInstance.close(),k()})}}]);