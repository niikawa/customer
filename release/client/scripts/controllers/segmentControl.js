var segmentControlCtrl=angular.module("segmentControlCtrl",["SegmentServices","QueryServices"]);segmentControlCtrl.controller("SegmentControlCtrl",["$scope","$routeParams","Modal","Shared","Segment","Query","Utility","Location",function(a,b,c,d,e,f,g,h){function i(){a.pageTitle=e.pageProp(b.id).pageTitle,a.viewMode=e.pageProp(b.id).viewMode,a.segmenData={},a.queryList=[],a.conditions=[],a.segmentSearch="",a.segment={},a.isExecte=!1}a.initialize=function(){a._construct(),i(),d.setRoot("segment control"),f.resource.getQuery().$promise.then(function(c){2===e.pageProp(b.id).viewMode?e.resource.get({id:b.id}).$promise.then(function(d){a.segment.segment_id=b.id,a.segment.segment_name=d.segment_name,a.segment.segment_document_id=d.segment_document_id,e.setListData(c.data,d.qIds,a.conditions),a.queryList=c.data,e.setWhereProp(a.queryList),e.setWhereProp(a.conditions,d.whereList),a.isExecte=!0}):(a.queryList=c.data,e.setWhereProp(a.queryList))})},a.moveQuery=function(b){a.conditions.push(a.queryList[b]),a.queryList.splice(b,1),a.isExecte=!0},a.removeItem=function(b){a.queryList.push(a.conditions[b]),a.conditions.splice(b,1),0===a.conditions.length&&(a.isExecte=!1)},a.save=function(){var b=e.createDocData(a.conditions),c={segment_name:a.segment.segment_name,segment_document_id:a.segment.segment_document_id,whereList:b.whereList,qIds:b.qIds};e.resource.saveDoc({data:c}).$promise.then(function(b){var c={segment_id:a.segment.segment_id,segment_name:b.data.segment_name,segment_document_id:b.data.id};e.resource.save({data:c}).$promise.then(function(){g.info("セグメントを保存しました"),h.segment()})})},a.execute=function(){var b=e.createExecuteInfo(a.conditions);e.resource.executeQuery(b).$promise.then(function(a){g.info("該当データは"+a.result+"件あります")})}}]);