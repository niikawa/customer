var myApp=angular.module("myApp");myApp.directive("lineChart",["d3Service","$parse","$window",function(a,b,c){var d=a.d3;return{restrict:"EA",scope:{data:"=",type:"@",headerLabel:"=",legendLabel:"="},link:function(a,b){function e(a){return-1===k.indexOf(a)?k[0]:a}function f(){if(void 0!==a.legendLabel){var c=angular.isArray(a.legendLabel)?a.legendLabel.length:0;if(0!==c){var e={width:"100%",height:15*c},f=d.select(b[0]).append("svg").attr("width",e.width).attr("height",e.height);f.selectAll("rect").data(a.legendLabel).enter().append("rect").attr("class","pull-right").attr("width",50).attr("height",5).attr("x",i.width()-150).attr("y",function(a,b){return 20*b}).attr("fill",function(a,b){return j[b]}),f.selectAll("text").data(a.legendLabel).enter().append("text").text(function(a){return a}).attr("x",function(){return i.width()-250}).attr("y",function(a,b){return 0===b?10:5*b+20})}}}function g(c){var f={width:i.width(),height:i.height()/2},g=f.width-l.left-l.right-50,h=f.height-l.top-l.bottom,j=d.time.scale().range([0,g]),k=d.scale.linear().range([h,0]),n=d.svg.axis().scale(j).orient("bottom").innerTickSize(-h).outerTickSize(0).tickFormat(d.time.format("%Y/%m")),o=d.svg.axis().scale(k).orient("left").innerTickSize(-g).outerTickSize(0),p=d.select(b[0]).append("svg").attr("width","100%").attr("height",f.height).append("g").attr("transform","translate("+l.left+","+l.top+")"),q=e(a.type),r=d.svg.line().x(function(a){return j(a.date)}).y(function(a){return k(a.price)}).interpolate(q);angular.forEach(a.data,function(a,b){a.forEach(c?function(a){a.date=a.date,a.price=+a.price}:function(a){a.date=m(a.date),a.price=+a.price});var e="line-avg";0===b&&(e="line-main",j.domain(d.extent(a,function(a){return a.date})).nice(),k.domain(d.extent(a,function(a){return a.price})).nice(),p.append("g").attr("class","x axis").attr("transform","translate(0, "+(f.height-l.top-l.bottom)+")").call(n).selectAll("text").attr("transform","rotate (-70)").attr("dx","-5em").attr("dy","-0.1em").style("text-anchor","start"),p.append("g").attr("class","y axis").call(o).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".7em").style("text-anchor","end")),p.append("path").datum(a).attr("class",e).attr("d",r)})}function h(){b.children("svg").length>0&&b.children("svg").remove()}var i=angular.element(c),j=["#FF8C00","#A9A9A9"],k=["linear","linear-closed","step","step-before","step-after","basis","basis-open","basis-close","bundle","cardinal","cardinal-open","cardinal-close","monotone"],l={top:40,right:40,bottom:70,left:90},m=d.time.format("%Y/%m").parse;a.$watchCollection("data",function(){if(void 0!==a.headerLabel&&""!==a.headerLabel){b.children("p").length>0&&b.children("p").remove();var c='<p class="line-title">'+a.headerLabel+"</p>";b.append(c)}a.data&&(h(),f(!1),g(!1))}),i.on("resize",function(){h(),f(!0),g(!0)})}}}]);