"use strict";angular.module("myApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMessages","ngFileUpload","ui.bootstrap","coreCtrl","loginCtrl","mainCtrl","dashbordCtrl","segmentCtrl","segmentControlCtrl","queryCtrl","queryListCtrl","scenarioCtrl","scenarioControlCtrl","approachCtrl","userCtrl","userControlCtrl","accessCtrl","bugCtrl","mapCtrl"]).config(function(a){var b=function(a,b,c,d,e){var f=b.defer();return a.post("/auth/isLogin",{remembertkn:d.remembertkn}).success(function(a){e.set("id",a.data.user_id),e.set("userName",a.data.name),e.set("role",a.data.role_id),f.resolve(!0)}).error(function(){c.location.href="https://"+location.host+"/#/login"}),f.promise},c=function(a,b,c,d){var e=b.defer();return 1==d.get("role")?e.resolve(!0):c.location.href="https://"+location.host+"/#/",e.promise};a.when("/",{templateUrl:"views/dashbord.html",controller:"DashbordCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/customer",{templateUrl:"views/customer/customer.html",controller:"MainCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/segment",{templateUrl:"views/segment/segment.html",controller:"SegmentCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/segment/control",{templateUrl:"views/segment/segmentControl.html",controller:"SegmentControlCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/segment/control/:id",{templateUrl:"views/segment/segmentControl.html",controller:"SegmentControlCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/query/list",{templateUrl:"views/query/queryList.html",controller:"QueryListCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/query",{templateUrl:"views/query/query.html",controller:"QueryCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/query/control/:id",{templateUrl:"views/query/query.html",controller:"QueryCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/query/set",{templateUrl:"views/query/querySetting.html",controller:"QueryCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/query/save",{templateUrl:"views/query/querySave.html",controller:"QueryCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/scenario/:scenario",{templateUrl:"views/scenario/scenario.html",controller:"ScenarioCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/scenario/:scenario/control",{templateUrl:"views/scenario/scenarioControl.html",controller:"ScenarioControlCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/scenario/:scenario/control/:id",{templateUrl:"views/scenario/scenarioControl.html",controller:"ScenarioControlCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/approach",{templateUrl:"views/approach/approach.html",controller:"ApproachCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/user",{templateUrl:"views/user/user.html",controller:"UserCtrl",reloadOnSearch:!1,resolve:{isLogin:b,isShow:c}}).when("/user/control",{templateUrl:"views/user/userControl.html",controller:"UserControlCtrl",reloadOnSearch:!1,resolve:{isLogin:b,isShow:c}}).when("/user/control/:id",{templateUrl:"views/user/userControl.html",controller:"UserControlCtrl",reloadOnSearch:!1,resolve:{isLogin:b,isShow:c}}).when("/access",{templateUrl:"views/access/history.html",controller:"AccessCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/access/:id",{templateUrl:"views/access/timeLine.html",controller:"AccessCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/release",{templateUrl:"views/note/releaseNotes.html",reloadOnSearch:!1,resolve:{isLogin:b}}).when("/release/bug",{templateUrl:"views/note/bugNotes.html",controller:"BugCtrl",reloadOnSearch:!1,resolve:{isLogin:b}}).otherwise({redirectTo:"/"})});var myApp=angular.module("myApp");myApp.config(function(a){a.interceptors.push(function(a,b,c){return{request:function(a){return b.$broadcast("requestStart"),a.requestTimestamp=(new Date).getTime(),a},requestError:function(){b.$broadcast("requestEnd")},response:function(a){return b.$broadcast("requestEnd"),a.config.responseTimestamp=(new Date).getTime(),a},responseError:function(d){return b.$broadcast("requestEnd"),400<=d.status&&500>d.status?c.errorSticky("通信に失敗しました"):500<=d.status&&511===d.status&&c.errorSticky(d.data?d.data:"システムエラーが発生しました"),a.reject(d)}}})});var coreCtrl=angular.module("coreCtrl",[]);coreCtrl.controller("CoreCtrl",["$scope","Shared",function(a,b){a.isHeader=void 0!==b.get("id"),b.set("isSpinner",!1),a._construct=function(){a.isHeader=!0},a.$on("loginComplete",function(){a.isHeader=!0,a.userName=b.get("userName")}),a.$on("loginInit",function(){a.isHeader=!1}),a.$on("loginFailed",function(){a.isHeader=!1}),a.$on("logoutConplete",function(){a.isHeader=!1}),a.$on("requestStart",function(){a.isSpinner=!0}),a.$on("requestEnd",function(){a.isSpinner=!1})}]);var mainCtrl=angular.module("mainCtrl",["CustomerServices","AzureServices"]);mainCtrl.controller("MainCtrl",["$scope","Shared","Customer","Azure","Utility",function(a,b,c,d,e){function f(){a.customerList=[],a.approch=[],a.customer=[],a.rank="",a.selectedCustomer={},a.lineLabel="",a.addStyle="",a.legendLabel=[],a.isGetData=!1}a.initialize=function(){a._construct(),f(),c.resource.get().$promise.then(function(b){a.customerList=b.data})},a.custmoerChangeExecute=function(){a.$emit("requestStart"),c.resource.detail({id:a.selectedCustomer.Id}).$promise.then(function(b){a.customer=b.customer,a.approch=b.approch,a.rank=a.approch[0].name,a.addStyle="two-row";var c=e.diffMonth(b.customer.last_purchasing_date,b.customer.start_purchasing_date);a.customer.frequency_avg=Math.round(10*b.customer.frequency/c)/10,a.customer.monetary_avg=Math.round(b.customer.monetary/c),a.customer.last_purchasing_date=e.formatString(a.customer.last_purchasing_date,"YYYY年MM月DD日"),a.lineLabel="直近1年の売上推移（月別サマリ）",a.legendLabel=[a.selectedCustomer.customer_id,"ランク平均"],a.orders=[b.orders,b.orders_avg],a.$emit("requestEnd"),a.isGetData=!0})},a.recomender=function(){a.$emit("requestStart"),d.resource.recomender({id:a.selectedCustomer.Id}).$promise.then(function(b){if(a.$emit("requestEnd"),""===b.data)e.successSticky("おすすめ商品はありません");else{var c=b.data[0];delete c[0],e.successSticky(c.join())}})}}]);var loginCtrl=angular.module("loginCtrl",["AuthServices"]);loginCtrl.controller("LoginCtrl",["$scope","$location","Auth","Location",function(a,b,c,d){a.initialize=function(){a.$emit("loginInit"),a.data={mailAddress:"",password:"",remember:!1}},a.submit=function(){a.$emit("requestStart"),c.login(a.data).then(function(){a.$emit("requestEnd"),a.$emit("loginComplete"),d.home()},function(){a.$emit("requestEnd")})}}]);var mainCtrl=angular.module("dashbordCtrl",["ScenarioServices"]);mainCtrl.controller("DashbordCtrl",["$scope","Shared","Scenario","Utility","Modal",function(a,b,c,d,e){function f(){a.scenario=[],a.executePlanScenario=[]}function g(){c.resource.typeCount().$promise.then(function(b){a.scenarioList=b.data,c.resource.executeplan().$promise.then(function(b){a.isShowExecutePlanScenario=b.data.length>0,a.executePlanScenario=b.data})})}a.initialize=function(){a.$emit("requestStart"),a._construct(),f(),g(),b.setRoot("dashbord"),a.$emit("requestEnd")},a.bulkInvalid=function(){a.modalParam={title:"シナリオの一括無効について",message:"実行予定のシナリオをすべて無効にしますがよろしいですか？<br>再度有効にする場合はアプローチ管理画面から有効にできます。",isExecute:!0,executeLabel:"一括で無効にする",execute:function(){c.resource.bulkInvalid().$promise.then(function(){a.modalInstance.close(),d.info("実行予定のシナリオを一括無効しました。"),a.initialize()})}},a.modalInstance=e.open(a,"partials/modal/message.html")}}]);var segmentCtrl=angular.module("segmentCtrl",["SegmentServices"]);segmentCtrl.controller("SegmentCtrl",["$scope","Shared","Segment","Utility",function(a,b,c,d){function e(){b.setRoot("segment"),a.segmentList=[]}a.initialize=function(){a._construct(),e(),c.resource.get().$promise.then(function(b){a.segmentList=b.data,a.showInfo=a.segmentList.length>0?!0:!1})},a.download=function(a){c.download(a)},a.remove=function(b){var e=a.segmentList[b];console.log(e),c.resource.remove({id:e.segment_id,segment_document_id:e.segment_document_id}).$promise.then(function(){d.info("削除しました"),a.segmentList.splice(b,1)})}}]);var segmentControlCtrl=angular.module("segmentControlCtrl",["SegmentServices","QueryServices"]);segmentControlCtrl.controller("SegmentControlCtrl",["$scope","$routeParams","Modal","Shared","Segment","Query","Utility","Location",function(a,b,c,d,e,f,g,h){function i(){a.pageTitle=e.pageProp(b.id).pageTitle,a.viewMode=e.pageProp(b.id).viewMode,a.segmenData={},a.queryList=[],a.conditions=[],a.segmentSearch="",a.segment={},a.isExecte=!1}a.initialize=function(){a._construct(),i(),d.setRoot("segment control"),f.resource.getQuery().$promise.then(function(c){2===e.pageProp(b.id).viewMode?e.resource.get({id:b.id}).$promise.then(function(d){a.segment.segment_id=b.id,a.segment.segment_name=d.segment_name,a.segment.segment_document_id=d.segment_document_id,e.setListData(c.data,d.qIds,a.conditions),a.queryList=c.data,e.setWhereProp(a.queryList),e.setWhereProp(a.conditions,d.whereList),a.isExecte=!0}):(a.queryList=c.data,e.setWhereProp(a.queryList))})},a.moveQuery=function(b){a.conditions.push(a.queryList[b]),a.queryList.splice(b,1),a.isExecte=!0},a.removeItem=function(b){a.queryList.push(a.conditions[b]),a.conditions.splice(b,1),0===a.conditions.length&&(a.isExecte=!1)},a.save=function(){var b=e.createDocData(a.conditions),c={segment_name:a.segment.segment_name,segment_document_id:a.segment.segment_document_id,whereList:b.whereList,qIds:b.qIds};e.resource.saveDoc({data:c}).$promise.then(function(b){var c={segment_id:a.segment.segment_id,segment_name:b.data.segment_name,segment_document_id:b.data.id};e.resource.save({data:c}).$promise.then(function(){g.info("セグメントを保存しました"),h.segment()})})},a.execute=function(){var b=e.createExecuteInfo(a.conditions);e.resource.executeQuery(b).$promise.then(function(a){g.info("該当データは"+a.result+"件あります")})}}]);var scenarioCtrl=angular.module("scenarioCtrl",["ScenarioServices"]);scenarioCtrl.controller("ScenarioCtrl",["$scope","$routeParams","Shared","Utility","Scenario",function(a,b,c,d,e){function f(){a.addPageTitle=e.getPageProp(b.scenario).title,a.type=b.scenario,a.scenarioList=[]}a.initialize=function(){c.setRoot("scenario"),a._construct(),f(),e.resource.get({type:b.scenario}).$promise.then(function(b){a.isScenarioShow=b.data.length>0?!0:!1,a.isScenarioShow&&(a.scenarioList=b.data)})},a.remove=function(c){if(void 0===c||isNaN(parseInt(c,10)))return!1;var f=a.scenarioList[c].scenario_id,g=a.scenarioList[c].scenario_name,h={type:b.scenario,id:f};e.resource.remove(h).$promise.then(function(){d.info(g+"<br>を削除しました。"),a.scenarioList.splice(c,1),a.isScenarioShow=a.scenarioList.length>0?!0:!1})}}]);var scenarioControlCtrl=angular.module("scenarioControlCtrl",["ScenarioServices","SegmentServices"]);scenarioControlCtrl.controller("ScenarioControlCtrl",["$scope","$routeParams","Modal","Shared","Utility","Location","Scenario",function(a,b,c,d,e,f,g){function h(){a.isBaseCollapse=!1,a.isOriginCollapse=!1,a.isShowExtraction=!1,a.pageTitle=o.title+o.addTitle,a.scenario={},a.scenario.approach,a.scenario.status,a.type=b.scenario,a.template=o.template,a.inputTag="",a.tagList=[],a.selectTagList=[],a.isTagCollapse=!1,d.setRoot(a.type+" scenario"),1===o.type?a.specificInfo={repeat_flag:null,expiration_start_date:e.today("YYYY-MM-DD"),expiration_end_date:"",interval:0,intervalCondition:"",daysCondition:g.daysCondition(),weekCondition:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1}}:2===o.type&&(a.conditions=[],a.specificInfo={},a.decisionList=[])}function i(){a.validators={segment:{isSelect:function(){var b=a.segmentList||{},c=!1;return angular.forEach(b,function(a){a.isPush&&(c=!0)}),c}},ifLayout:{isSelect:function(){var b=a.ifList||{},c=!1;return angular.forEach(b,function(a){a.isPush&&(c=!0)}),c}},expiration_start_date:{isDateValid:function(a,b){var c=a||b;return e.isDateValid(c)}},expiration_end_date:{isDateValid:function(a,b){var c=a||b;return e.isDateValid(c)},isAfter:function(b,c){var d=b||c;return e.isAfter(d,a.specificInfo.expiration_start_date)}},interval:{isSelect:function(a,b){var c=a||b;return 0!==c}},weekCondition:{isSelect:function(){var b=a.specificInfo.weekCondition||{},c=!1;return angular.forEach(b,function(a){a&&(c=!0)}),c}},daysCondition:{isSelect:function(){var b=a.specificInfo.daysCondition||{},c=!1;return angular.forEach(b,function(a){a.check&&(c=!0)}),c}}},a.asyncValidators={scenario_name:{same:function(a,b){var c=a||b;return void 0===c||0===c.length?!0:g.validators.isSameName({id:p,scenario_name:c})}},output_name:{same:function(a,b){var c=a||b;return void 0===c||0===c.length?!0:g.validators.isSameName({id:p,output_name:c})}}}}function j(){var c={type:b.scenario},d=void 0!==p;d&&(c.id=p),g.resource.initializeData(c).$promise.then(function(b){a.segmentList=b.segment,a.ifList=b.ifLayout,a.scenario=b.target,a.tagList=b.tagList,a.selectTagList=b.settinTags,1===o.type?d&&k(b):2===o.type&&(a.actionList=b.specific,d&&(a.activeId=b.specificInfo.doc.actionId,l(b)))})}function k(b){a.specificInfo.repeat_flag=b.specificInfo.specific.repeat_flag,a.specificInfo.expiration_start_date=e.formatString(b.specificInfo.specific.expiration_start_date),null!==b.specificInfo.specific.expiration_end_date&&(a.specificInfo.expiration_end_date=e.formatString(b.specificInfo.specific.expiration_end_date)),null!==b.specificInfo.doc&&(a.specificInfo.interval=b.specificInfo.doc.interval,2===a.specificInfo.interval?a.specificInfo.weekCondition=b.specificInfo.doc.weekCondition:3===a.specificInfo.interval&&(a.specificInfo.daysCondition=b.specificInfo.doc.daysCondition))}function l(b){a.specificInfo=b.specificInfo.specific,q=b.specificInfo.doc.actionId,a.isShowExtraction=!0;for(var c=b.specific.length,d=0;c>d;d++)if(q===b.specific[d].id){a.columnList=b.specific[d].column;break}angular.forEach(b.specificInfo.doc.conditionList,function(b){var c=[];angular.forEach(b,function(b){angular.forEach(a.columnList,function(a){b.physicalname==a.physicalname&&(a.condition=b.condition,a.selectedCondition=b.selectedCondition,c.push(a))})}),r.push(c);var d=g.createCondtionString(c);a.decisionList.push(d)})}function m(){a.$watch("scenario.scenario_name",function(){a.scenarioForm.scenario_name.$validate()}),a.$watch("scenario.output_name",function(){a.scenarioForm.output_name.$validate()}),a.$watch("segmentList",function(){a.scenarioForm.segment.$validate()},!0),a.$watch("ifList",function(){a.scenarioForm.ifLayout.$validate()},!0),1===o.type&&(null!==a.specificInfo.repeat_flag&&a.$watch("specificInfo.expiration_start_date",function(){a.scenarioForm.expiration_start_date.$validate()}),1===a.specificInfo.repeat_flag&&(a.$watch("specificInfo.expiration_end_date",function(){a.scenarioForm.expiration_end_date.$validate()}),a.$watch("specificInfo.interval",function(){a.scenarioForm.interval.$validate()})))}function n(){}var o=g.getPageProp(b.scenario,b.id),p=b.id,q=0,r=[];a.initialize=function(){a._construct(),h(),j(),i(),m(),n()},a.showAction=function(b,c){a.conditions=[],a.decisionList=[],q==b?a.isShowExtraction=!a.isShowExtraction:(a.isShowExtraction=!0,a.columnList=c,q=b)},a.addTag=function(){if(!(0>=a.inputTag.length)){var b=!0;angular.forEach(a.selectTagList,function(c){return a.inputTag===c.tag_name?(b=!1,!1):void 0}),b&&(a.selectTagList.push({tag_name:a.inputTag}),a.inputTag="")}},a.removeTag=function(b){a.selectTagList.splice(b,1)},a.moveCondition=function(b){var c={};angular.copy(b,c),a.conditions.push(c)},a.removeItem=function(b){a.conditions.splice(b,1)},a.decision=function(){var b=!0;if(angular.forEach(a.conditions,function(a){return a.error||""===a.condition.value1||void 0===a.condition.value1?(b=!1,!1):void 0}),b){r.push(a.conditions);var c=g.createCondtionString(a.conditions);a.decisionList.push(c),a.conditions=[]}},a.removeDecisionList=function(b){r.splice(b,1),a.decisionList.splice(b,1)},a.clear=function(){h(),j()},a.save=function(){var b,c;if(1===o.type)c={repeat_flag:a.specificInfo.repeat_flag,expiration_start_date:a.specificInfo.expiration_start_date,expiration_end_date:a.specificInfo.expiration_end_date},1==a.specificInfo.repeat_flag&&(b={interval:a.specificInfo.interval},2===a.specificInfo.interval?b.weekCondition=a.specificInfo.weekCondition:3===a.specificInfo.interval&&(b.daysCondition=a.specificInfo.daysCondition));else{if(2!==o.type)return!1;if(0===r.length)return!1;b={actionId:q,conditionList:g.getConditionDoc(r)},c=a.specificInfo}a.scenario.scenario_type=o.type,g.setActivePushItem(a.segmentList,"segment_id",a.scenario,"segment_id"),g.setActivePushItem(a.ifList,"id",a.scenario,"if_layout_id");var d={scenario:a.scenario,specificInfo:c,doc:b,tags:a.selectTagList};g.resource.save(d).$promise.then(function(){e.info("シナリオを保存しました。"),1===o.type?f.schedule():2===o.type&&f.trigger()})},a.weekConditionValidation=function(){a.scenarioForm.weekCondition.$validate()},a.daysConditionValidation=function(){a.scenarioForm.daysCondition.$validate()}}]);var queryListCtrl=angular.module("queryListCtrl",["QueryServices"]);queryListCtrl.controller("QueryListCtrl",["$scope","Shared","Query","Segment","Modal","Location","Utility",function(a,b,c,d,e,f,g){function h(){a.queryList=[],b.setRoot("query list")}a.initialize=function(){a._construct(),h(),c.resource.getList().$promise.then(function(b){a.queryList=b.data,a.isQueryShow=a.queryList.length>0})},a.showSegment=function(b){if(void 0!==a.queryList[b].id){var c=a.queryList[b],g={qId:c.id,count:c.useNum};d.resource.useSegment(g).$promise.then(function(c){a.modalParam={title:a.queryList[b].query_name+"を利用しているセグメント",list:c.data,hrefBase:"#/segment/control",dynamicParamKey:"id",close:function(b){a.modalInstance.close(),f.segmentControl(b)}},a.modalInstance=e.open(a,"partials/modal/list.html")})}},a.deleteItem=function(b){if(void 0!==a.queryList[b]){var d=a.queryList[b].query_name;c.resource.remove({id:a.queryList[b].id}).$promise.then(function(){g.info(d+"<br>を削除しました。"),a.queryList.splice(b,1)})}}}]);var queryCtrl=angular.module("queryCtrl",["QueryServices"]);queryCtrl.controller("QueryCtrl",["$scope","$routeParams","Shared","Query","Location","Utility",function(a,b,c,d,e,f){function g(b){c.destloyByName("queryName"),c.destloyByName("updateQueryDocumentId"),a.tableList=[],a.tableListRef=[],a.columnNum=0,a.selectColumns=[],b||(a.selectColumns=c.get("queryColumns")||[]),a.showSelectedColumnsBox=a.selectColumns.length>0,a.conditions=[],a.isShowEditMessage=!1,a.returnUrl=d.getReturnURL(),c.setRoot("query")}function h(b){angular.forEach(b.tables,function(b,c){angular.forEach(b,function(b){angular.forEach(a.tableList[c].column,function(d){return b.column===d.physicalname?(a.selectColumns.push({table:{logicalname:a.tableList[c].logicalname,physicalname:a.tableList[c].physicalname},column:d,selectedCondition:{name:"",value:b.conditionType,symbol:""},condition:b.values}),!1):void 0})})}),a.showSelectedColumnsBox=a.selectColumns.length>0,c.set("queryColumns",a.selectColumns)}function i(){a.docIdUrl="";var b=c.get("updateQueryDocumentId");void 0!==b&&(a.docIdUrl="/control/"+b,a.isShowEditMessage=!0,a.queryName=c.get("updateQueryName"))}function j(){a.$on("dropItemComplete",function(b){b.stopPropagation(),angular.forEach(a.showConditions,function(a){console.log(a.length),1===a.length&&(a.isJoin=!1)})})}var k="";a.initialize=function(){var e=b.hasOwnProperty("id");a._construct(),g(e),e?d.resource.getControlInit({id:b.id}).$promise.then(function(e){a.queryName=e.data.query_name,a.tableList=e.table,a.tableListRef=d.getRefTabels(e.table),0===a.selectColumns.length&&h(e.data),a.isShowEditMessage=!0,c.set("updateQueryDocumentId",b.id),c.set("updateQueryName",e.data.query_name)}):d.resource.get().$promise.then(function(b){a.tableList=b.table,a.tableListRef=d.getRefTabels(b.table)})},a.showColumns=function(b){k=b,a.columnList=a.tableList[b].column,a.columnNum=a.columnList.length},a.setColumn=function(b){var d=a.tableList[k],e=!1;angular.forEach(a.selectColumns,function(a){a.table.physicalname===k&&a.column.physicalname===d.column[b].physicalname&&(e=!0)}),e||a.selectColumns.push({table:{logicalname:d.logicalname,physicalname:d.physicalname},column:d.column[b]}),a.showSelectedColumnsBox=!0,c.set("queryColumns",a.selectColumns)},a.removeColumn=function(b){a.selectColumns.splice(b,1),a.showSelectedColumnsBox=a.selectColumns.length>0,c.set("queryColumns",a.selectColumns)},a.nextValidation=function(){c.setRoot("query set"),a.selectColumns=c.get("queryColumns"),void 0===a.selectColumns&&e.query(),angular.forEach(a.selectColumns,function(){}),i()},a.removeItem=function(b){a.selectColumns.splice(b,1),0===a.selectColumns.length&&e.query()},a.next=function(){var b=!1;angular.forEach(a.selectColumns,function(a){return a.error?!1:void(b=!0)}),b&&e.querySave()},a.saveInitialize=function(){c.setRoot("query save"),j(),i(),a.query={query_name:c.get("updateQueryName")},a.conditions=[];var b=c.get("queryColumns");void 0===b&&e.query(),a.selectColumns=[],d.createCondtionString(b),a.showConditions=[],angular.forEach(b,function(b){var c=[];c.push(b),c.isJoin=!1,a.showConditions.push(c)})},a.isJoin=function(a){return a.isJoin},a.release=function(b,c){var d=[];d.push(a.showConditions[b][c]),console.log("削除前："+a.showConditions.length),a.showConditions[b].splice(c,1),console.log("削除後："+a.showConditions.length),console.log(a.showConditions),1===a.showConditions[b].length&&(a.showConditions[b].isJoin=!1),a.showConditions.push(b,0,d),console.log("ぷっしゅ後："+a.showConditions.length),console.log(a.showConditions)},a.save=function(){var b=c.get("queryColumns"),g=d.getTables(b),h={query_document_id:c.get("updateQueryDocumentId"),query_name:a.query.query_name,conditionList:a.showConditions,tables:g};d.resource.create(h).$promise.then(function(){c.destloyByName("queryColumns"),c.destloyByName("updateQueryName"),c.destloyByName("updateQueryDocumentId"),f.info("クエリを保存しました"),e.query()})},a.execute=function(){var b=c.get("queryColumns"),e=d.getTables(b),g={tables:e,conditionList:a.showConditions};d.resource.executeQuery(g).$promise.then(function(a){f.info("該当データは"+a.result+"件あります")})}}]);var approachCtrl=angular.module("approachCtrl",["ApproachServices","ScenarioServices"]);approachCtrl.controller("ApproachCtrl",["$scope","$routeParams","Shared","Utility","Approach","Scenario","Modal",function(a,b,c,d,e,f,g){function h(){a.approach=[],a.scenarioList=[],a.showScenarioList=!1}function i(){e.resource.get().$promise.then(function(b){a.approach=b.data,f.resource.valid().$promise.then(function(b){a.scenarioList=b.data,a.showScenarioList=0<a.scenarioList.length})})}function j(){a.$on("dropItemComplete",function(b,c){a.scenarioList=c.to,a.$apply()})}a.initialize=function(){a._construct(),h(),i(),j(),c.setRoot("approach")},a.save=function(){console.log(a.approach),e.resource.save(a.approach).$promise.then(function(){d.info("設定を更新しました")})},a.savePriority=function(){console.log(a.scenarioList),f.resource.priority({data:a.scenarioList}).$promise.then(function(){d.info("優先順位を更新しました")})},a.showDiscription=function(b){var c=e.getInfomation(b);a.modalParam={title:c.title,message:c.message,isExecute:!1},a.modalInstance=g.open(a,"partials/modal/message.html")},a.bulkInvalid=function(){var b={title:"シナリオの一括無効について",text:"有効なシナリオをすべて無効にしますがよろしいですか？<br>実行した場合、実行予定シナリオはなくなります。",confirmButtonText:"一括で無効にする",execute:function(){f.resource.bulkInvalid().$promise.then(function(){d.info("アプローチ対象シナリオをすべて無効しました。"),a.initialize()})}};d.infoAlert(b)},a.bulkEnable=function(){var b={title:"シナリオの一括有効について",text:"無効なシナリオをすべて有効にしますがよろしいですか？<br>実行した場合、実行予定シナリオとしてダッシュボード画面に表示されます。",isExecute:!0,confirmButtonText:"一括で有効にする",execute:function(){f.resource.bulkEnable().$promise.then(function(){d.info("アプローチ対象シナリオをすべて有効しました。"),a.initialize()})}};d.infoAlert(b)}}]);var userCtrl=angular.module("userCtrl",["UesrServices"]);userCtrl.controller("UserCtrl",["$scope","$routeParams","Shared","User","Utility",function(a,b,c,d,e){function f(){a.userList=[]}a.initialize=function(){c.setRoot("user"),a._construct(),f(),d.resource.get().$promise.then(function(b){a.userList=b.data})},a.remove=function(b){d.resource["delete"]({id:b}).$promise.then(function(){angular.forEach(a.userList,function(c,d){c.user_id===b&&a.userList.splice(d,1)}),e.successSticky("ユーザーを削除しました")})}}]);var userControlCtrl=angular.module("userControlCtrl",["UesrServices","RoleServices"]);userControlCtrl.controller("UserControlCtrl",["$scope","$routeParams","User","Role","Utility","Shared","Location",function(a,b,c,d,e,f,g){function h(){if(a.user={},a.pageTitle=k.title,a.showPassword=!0,a.passwordEdit={show:"1"},a.pageType=k.type,2===k.type){a.passwordEdit.show="0",a.showPassword=!1;var d=parseInt(b.id,10);c.resource.get({id:d}).$promise.then(function(b){a.user=b.data[0],a.user.password_confirm=a.user.password})}}function i(){a.validators={password:{same:function(b,c){var d=b||c,e=a.user||{};return d!=e.name}},password_confirm:{confirm:function(b,c){var d=a.user||{},e=b||c;return e==d.password}},selected_role:{role:function(){var b=a.roleList||{},c=!1;return angular.forEach(b,function(a){a.isPush&&(c=!0)}),c}}},a.asyncValidators={mailaddress:{same:function(b,d){var e=b||d;return void 0===e||0===e.length?!0:c.validators.isSameMailAddress(a.user.user_id,e)}}}}function j(b){angular.forEach(b,function(b){b.isPush&&(a.user.role_id=b.role_id)})}var k=c.getPageProp(b.id);a.initialize=function(){f.setRoot("user control"),a._construct(),h(),i(),d.resource.get().$promise.then(function(b){a.roleList=b.data}),1===a.passwordEdit&&(a.$watch("user.name",function(){a.userForm.password.$validate()}),a.$watch("user.password",function(){a.userForm.password_confirm.$validate()})),a.$watch("roleList",function(){a.userForm.selected_role.$validate()},!0)},a.save=function(){j(a.roleList);var b=a.user.name+"さんの情報を保存しました";2===k.type?(e.deleteCommonInfo(a.user),"1"!==a.passwordEdit.show&&(delete a.user.password_confirm,delete a.user.password),c.resource.save({id:a.user.user_id,data:a.user}).$promise.then(function(){e.successSticky(b),g.user()})):c.resource.create({data:a.user}).$promise.then(function(){e.successSticky(b),g.user()})},a.isSameMailAddress=function(){a.userForm.mailaddress.$validate()}}]);var accessCtrl=angular.module("accessCtrl",["AccessServices"]);accessCtrl.controller("AccessCtrl",["$scope","$sce","$routeParams","Shared","Access","Utility",function(a,b,c,d,e,f){function g(){a.showDate="",a.serchDay="",d.destloy("serchDay"),d.setRoot("accsess")}function h(){var b=f.today("YYYY-MM-DD");e.resource.day({day:b}).$promise.then(function(b){a.logList=b.data})}function i(){var a=d.get("serchDay");void 0===a&&(a=f.today("YYYY-MM-DD")),j(a)}function j(b){e.resource.day({day:b,id:c.id}).$promise.then(function(c){a.targetName=c.data[0].name,a.showDate=b,a.timelineList=c.data})}a.initialize=function(){a.$emit("requestStart"),a._construct(),g(),h(),a.$emit("requestEnd")},a.serchByDay=function(){f.isDateValid(a.serchDay)&&e.resource.day({day:a.serchDay}).$promise.then(function(b){a.logList=b.data,d.set("serchDay",a.serchDay)})},a.timeLineInitialize=function(){i()},a.setPosition=function(a){return a%2==0}}]);var bugCtrl=angular.module("bugCtrl",["BugServices"]);bugCtrl.controller("BugCtrl",["$rootScope","$scope","$sce","Upload","Shared","Bug","Modal","Utility",function(a,b,c,d,e,f,g,h){function i(){b.bug={resolve:0,type:null}}function j(){k()}function k(){f.resource.getByConditon(b.bug).$promise.then(function(a){b.isBugShow=a.data.length>0,b.isBugShow&&(f.addViewInfo(a.data),b.bugList=a.data,b.roleId=a.role)})}function l(a){b.selectedFile.push(a[0])}function m(){if(0!==b.modalParam.newComment.length){var c={demand_bug_id:b.modalParam.id,comment:b.modalParam.newComment};null!==b.modalParam.files?(a.$broadcast("requestStart"),f.commentSaveAndUpload(b.modalParam.files,c,function(c){b.modalInstance.close(),null!==c&&h.error(c),k(),a.$broadcast("requestEnd")})):f.resource.saveComment(c).$promise.then(function(){b.modalInstance.close(),k()})}}b.selectedFile=[],b.initialize=function(){b._construct(),i(),j()},b.show=function(){b.modalParam={type:"",title:"",contents:"",category:"",categoryList:f.categoryList,files:null},b.modalInstance=g.open(b,"partials/modal/send.html")},b.apology=function(){h.info("障害ですか。。。<br>すみません！")},b.getByCondition=function(){k()},b.resolve=function(a){var c=b.bugList[a].title;f.resource.resolve({id:b.bugList[a].id}).$promise.then(function(){h.info(c+"<br>を解決しました。"),b.bugList[a].resolve_name="解決",k()})},b.save=function(){var c={type:b.modalParam.type,title:b.modalParam.title,contents:b.modalParam.contents,category:b.modalParam.category.type};null!==b.modalParam.files?(a.$broadcast("requestStart"),f.saveAndUpload(b.modalParam.files,c,function(c){b.modalInstance.close(),null!==c&&h.error(c),k(),a.$broadcast("requestEnd")})):f.resource.save(c).$promise.then(function(){h.info("ありがとございました。"),b.modalInstance.close(),k()})},b.showComment=function(a){b.modalParam={execute:m,onFileSelect:l,files:null,newComment:"",id:b.bugList[a].id},b.modalInstance=g.open(b,"partials/modal/comment.html")},b.showCommentView=function(a){f.resource.getComment({id:b.bugList[a].id}).$promise.then(function(c){b.bugList[a].comments=c.data})},b.vote=function(a){f.resource.vote({id:b.bugList[a].id}).$promise.then(function(){k()})},b.download=function(a){return null===a||void 0===a?!1:void f.resource.download({id:a}).$promise.then(function(){b.modalInstance.close(),k()})}}]);var mapCtrl=angular.module("mapCtrl",[]);mapCtrl.controller("MapCtrl",["$scope","Shared","Utility",function(a){function b(){}a.initialize=function(){a._construct(),b()}}]);var utilsServices=angular.module("myApp");utilsServices.service("Utility",["$rootScope",function(a){this.deleteCommonInfo=function(a){angular.isArray(a)?angular.forEach(a,function(a){a.hasOwnProperty("delete_flag")&&delete a.delete_flag,a.hasOwnProperty("create_by")&&delete a.create_by,a.hasOwnProperty("create_date")&&delete a.create_date,a.hasOwnProperty("update_by")&&delete a.update_by,a.hasOwnProperty("update_date")&&delete a.update_date}):(a.hasOwnProperty("delete_flag")&&delete a.delete_flag,a.hasOwnProperty("create_by")&&delete a.create_by,a.hasOwnProperty("create_date")&&delete a.create_date,a.hasOwnProperty("update_by")&&delete a.update_by,a.hasOwnProperty("update_date")&&delete a.update_date)},this.info=function(a,b){b=null==b?"top-center":b,$().toastmessage("showToast",{text:a,sticky:!1,position:b,type:"notice"})},this.infoSticky=function(a,b){b=null==b?"top-center":b,$().toastmessage("showToast",{text:a,sticky:!0,position:b,type:"notice"})},this.warning=function(a,b){b=null==b?"top-center":b,$().toastmessage("showToast",{text:a,sticky:!1,position:b,type:"warning"})},this.warningSticky=function(a,b){b=null==b?"top-center":b,$().toastmessage("showToast",{text:a,sticky:!0,position:b,type:"warning"})},this.error=function(a,b){b=null==b?"top-center":b;var c=0===a.trim().length?"通信エラー":a;$().toastmessage("showToast",{text:c,sticky:!1,position:b,type:"error"})},this.errorSticky=function(a,b){b=null==b?"top-center":b;var c=0===a.trim().length?"通信エラー":a;$().toastmessage("showToast",{text:c,sticky:!0,position:b,type:"error"})},this.success=function(a,b){b=null==b?"top-center":b,$().toastmessage("showToast",{text:a,sticky:!1,position:b,type:"success"})},this.successSticky=function(a,b){b=null==b?"top-center":b,$().toastmessage("showToast",{text:a,sticky:!0,position:b,type:"success"})},this.momentDefault=function(){return moment()},this.moment=function(a){return moment(a)},this.today=function(a){var b=null==a?"YYYY-MM-DD":a;return this.moment().format(b)},this.formatString=function(a,b){var c=null==b?"YYYY-MM-DD":b;return this.moment(a).format(c)},this.dayInMonth=function(a){return moment(a).daysInMonth()},this.isAfter=function(a,b){return moment(a).isAfter(moment(b))},this.getMomemtObject=function(a){return moment(a)},this.addDay=function(a,b){return moment(a).add(b,"day")},this.addMonth=function(a,b){return moment(a).add(b,"month")},this.addYear=function(a,b){return moment(a).add(b,"year")},this.subtractDay=function(a,b){return moment(a).subtract("day",b)},this.subtractMonth=function(a,b){return moment(a).subtract("month",b);

},this.subtractYear=function(a,b){return moment(a).subtract("year",b)},this.diffDay=function(a,b){return moment(a).diff(moment(b),"day")},this.diffMonth=function(a,b){return moment(a).diff(moment(b),"month")},this.diffYear=function(a,b){return moment(a).diff(moment(b),"year")},this.createDayList=function(a){for(var b=[],c=1;a>=c;c++){var d=("00"+c).slice(-2);b.push({value:d,text:d})}return b},this.createMonthList=function(){for(var a=[],b=1;12>b;b++){var c=("00"+b).slice(-2);a.push({value:c,text:c})}return a},this.createYearList=function(a,b){for(var c=[],d=a;b>=d;d++)c.push({value:String(d),text:d});return c},this.setSpinner=function(b){a.$broadcast(b?"requestStart":"requestEnd")},this.isDateValid=function(a,b){if(null===a)return!1;void 0===b&&(b="-");var c=a.split(b);if(3!==c.length)return!1;var d=this.moment(a);return d.isValid()},this.confirmAlert=function(a){swal({title:"削除してもよろしいですか？",type:"warning",allowOutsideClick:!0,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"削除する",cancelButtonText:"キャンセル",closeOnConfirm:!0,html:!1},function(){a()})},this.infoAlert=function(a){swal({title:a.title,text:a.text,type:"info",allowOutsideClick:!0,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:a.confirmButtonText,cancelButtonText:"閉じる",closeOnConfirm:!0,html:!0},function(){a.execute()})}}]);var sharedServices=angular.module("myApp");sharedServices.service("Shared",function(){var a={},b={};return a.set=function(a,c){b[a]=c},a.setRoot=function(a){b.hasOwnProperty("applicationAccsessRoot")||(b.applicationAccsessRoot=[]),b.applicationAccsessRoot.push(a)},a.getRoot=function(){return b.applicationAccsessRoot},a.get=function(a){return b[a]},a.destloyByName=function(a){delete b[a]},a.destloy=function(){b=[]},a});var authServices=angular.module("AuthServices",["ngResource","ngCookies"]);authServices.factory("Auth",["$resource","$http","$location","$cookies","Utility","Shared",function(a,b,c,d,e,f){var g={};return g.login=function(a){var c=b.post("/auth/login",{mailAddress:a.mailAddress,password:a.password}).success(function(b){a.remember&&(d.remembertkn=a.remembertkn),f.set("id",b.data[0].user_id),f.set("userName",b.data[0].name),f.set("role",b.data[0].role_id)});return c},g.setLoginStatus=function(a){var d=b.post("api/setStatus",{id:a}).success(function(){c.path("/")}).error(function(a){e.errorSticky(a)});return d},g.isLogin=function(){var a=b.post("api/isLogin",{}).success(function(){return!0}).error(function(a){e.errorSticky(a)});return a},g.logout=function(){var a=b.post("auth/logout",{}).success(function(){c.path("/login")}).error(function(a){e.errorSticky(a)});return a},g}]),authServices.factory("AutoAuth",["$window","$http","$q",function(a,b,c){var d=c.defer();b.post("api/auth",{}).success(function(){return d.promise}).error(function(){a.location.href="https://"+location.host})}]);var modalService=angular.module("myApp");modalService.service("Modal",["$modal",function(a){var b=function(b,c){return a.open({templateUrl:c,backdrop:"static",scope:b})};return{open:b}}]);var mailServices=angular.module("myApp");mailServices.service("Mail",["$resource",function(a){var b={};return b.resource=a("https://api-gozaru9.c9.io/V1/mail/:site/",{site:"@site"}),b}]),angular.module("myApp").factory("d3Service",function(){return{d3:d3}});var locationServices=angular.module("myApp");locationServices.service("Location",["$location",function(a){var b={};return b.home=function(){a.path("/")},b.user=function(){a.path("/user")},b.query=function(){a.path("/query")},b.query=function(){a.path("/query/list")},b.querySet=function(){a.path("/query/set")},b.querySave=function(){a.path("/query/save")},b.segment=function(){a.path("/segment")},b.segmentControl=function(b){a.path("/segment/control/"+b)},b.trigger=function(){a.path("/scenario/trigger")},b.schedule=function(){a.path("/scenario/schedule")},b}]);var mainServices=angular.module("myApp");mainServices.service("Main",function(){var a={};return a.getUserIdFromList=function(a,b){return a[b].my._id},a.getTaskIdFromList=function(a,b,c){return a[b].taskList[c]._id},a.removeTaskByIndex=function(a,b,c){a[b].taskList.splice(c,1)},a.getProgressFromList=function(a,b,c){return a[b].taskList[c].progress},a.getContentsFromList=function(a,b,c){return a[b].taskList[c].contents},a});var customerServices=angular.module("CustomerServices",["ngResource"]);customerServices.factory("Customer",["$resource","Utility",function(a){var b={};return b.resource=a("/customer/:id/",{id:"@id"},{detail:{method:"GET",url:"custmoer/detail/:id",cache:!0},orders:{method:"GET",url:"custmoer/orders/:id",cache:!0}}),b}]);var scenarioServices=angular.module("ScenarioServices",["ngResource"]);scenarioServices.factory("Scenario",["$resource","$http","$q","Utility",function(a,b,c){var d={},e={schedule:{type:1,mode:0,title:"スケジュール型",addTitle:"",template:"views/scenario/schedule.html"},trigger:{type:2,mode:0,title:"トリガー型",addTitle:"",template:"views/scenario/trigger.html"}};return d.daysCondition=function(){for(var a=[],b=31,c=1;b>=c;c++)a.push({name:c,check:!1});return a.push({name:"最終日",check:!1}),a},d.resource=a("/scenario/:type/:id/",{id:"@id"},{list:{method:"GET",url:"scenario/list/:id",cache:!0},initializeData:{method:"GET",url:"scenario/initialize/:type/:id"},action:{method:"GET",url:"action/:name",cache:!0},save:{method:"POST",url:"scenario/save"},remove:{method:"DELETE",url:"scenario/:type/remove/:id"},valid:{method:"GET",url:"scenario/valid"},priority:{method:"POST",url:"scenario/priority"},typeCount:{method:"GET",url:"scenario/typecount"},executeplan:{method:"GET",url:"scenario/execute/plan"},bulkInvalid:{method:"GET",url:"scenario/bulkInvalid"},bulkEnable:{method:"GET",url:"scenario/bulkEnable"}}),d.getPageProp=function(a,b){var c=e[a];return c.addTitle=void 0===b?"登録":"更新",c.mode=void 0===b?1:2,c},d.validators={isSameName:function(a){return b.post("scenario/name/",a).then(function(a){return a.data.result.count>0?c.reject("exists"):!1})}},d.setActivePushItem=function(a,b,c,d){angular.forEach(a,function(a){return a.isPush?(c[d]=a[b],!1):void 0})},d.createCondtionString=function(a){var b="",c=a.length-1;return angular.forEach(a,function(a,d){b+=a.logicalname+"が["+a.condition.value1,""!==a.condition.value2&&(b+=","+a.condition.value2),b+="]"+a.selectedCondition.name,d!==c&&(b+="AND"===a.condition.where?" かつ ":" または ")}),b},d.getConditionDoc=function(a){var b=[];return angular.forEach(a,function(a){var c=[];angular.forEach(a,function(a){c.push({physicalname:a.physicalname,condition:a.condition,selectedCondition:a.selectedCondition})}),b.push(c)}),b},d}]);var segmentServices=angular.module("SegmentServices",["ngResource"]);segmentServices.factory("Segment",["$resource","$http","Utility",function(a){var b={};return b.resource=a("/segment/:id/",{id:"@id"},{getDoc:{method:"GET",url:"segment/getdoc"},saveDoc:{method:"POST",url:"segment/savedoc"},save:{method:"POST",url:"segment/save"},download:{method:"GET",url:"segment/:id/download"},remove:{method:"DELETE",url:"segment/remove/:id/:segment_document_id"},executeQuery:{method:"POST",url:"segment/execute"},useSegment:{method:"POST",url:"/segment/query/use"}}),b.pageProp=function(a){return void 0===a?{viewMode:1,pageTitle:"登録"}:{viewMode:2,pageTitle:"更新"}},b.setWhereProp=function(a,b){void 0===b?angular.forEach(a,function(a){a.where="AND"}):angular.forEach(a,function(a,c){var d=null===b[c]?"AND":b[c];a.where=d})},b.setListData=function(a,b,c){angular.forEach(b,function(b){angular.forEach(a,function(d,e){b==d.id&&(c.push(d),a.splice(e,1))})})},b.createExecuteInfo=function(a){var b=[],c={},d={};return angular.forEach(a,function(a){b.push(a.id),c[a.id]=a.where,Object.keys(a.tables).forEach(function(a){d.hasOwnProperty(a)||(d[a]=a)})}),{qIds:b,tables:d,conditionMap:c}},b.createSQL=function(a){var b="",c=a.length-1;return angular.forEach(a,function(a,d){b+="("+a.sql+") ",c!==d&&(b+=a.where)}),b},b.getTables=function(a){var b={};return angular.forEach(a,function(a){Object.keys(a.tables).forEach(function(a){b.hasOwnProperty(a)||(b[a]=a)})}),b},b.createDocData=function(a){var b="",c=a.length-1,d=[],e=[];return angular.forEach(a,function(a,f){b+="("+a.sql+") ",c!==f&&(b+=a.where),d.push(a.id),e.push(a.where)}),{condition:b,qIds:d,whereList:e}},b}]);var queryServices=angular.module("QueryServices",["ngResource"]);queryServices.factory("Query",["$resource","$http","Shared",function(a,b,c){var d={};return d.sql="",d.resource=a("/query",{id:"@id"},{getQuery:{method:"GET",url:"/query/get"},getList:{method:"GET",url:"/query/list"},getControlInit:{method:"GET",url:"/query/control/:id"},create:{method:"POST",url:"/query/create"},remove:{method:"DELETE",url:"/query/:id"},getUseSegment:{method:"GET",url:"/query/use/segment/:id"},executeQuery:{method:"POST",url:"/query/execute"}}),d.getContentsByColumsType=function(a){var b={inputType:""};return console.log(a),"INT"===a?b.inputType="number":"VARCHAR"===a?b.inputType="text":"DATETIME"===a&&(b.inputType="date"),b.inputType},d.createCondtionString=function(a){angular.forEach(a,function(a){a.selectedCondition.condtionString=void 0===a.condition.value2||""===a.condition.value2?a.condition.value1+""+a.selectedCondition.name:a.condition.value1+"から"+a.condition.value2+a.selectedCondition.name})},d.getTables=function(a){var b={};return angular.forEach(a,function(a){void 0===b[a.table.physicalname]&&(b[a.table.physicalname]=[]);var c={column:a.column.physicalname,conditionType:a.selectedCondition.value,values:a.condition};b[a.table.physicalname].push(c)}),b},d.getRefTabels=function(a){var b=[];return angular.forEach(a,function(a){b.push(a)}),b},d.getReturnURL=function(){var a=c.getRoot(),b=a.length,d=a[a.length-1],e="";if("query list"===d)e="/query/list";else if("query list"===d)e="/segment/control";else for(b;b>0;b--){if("query list"===a[b]){e="/query/list";break}if("segment control"===a[b]){e="/segment/control";break}}return e},d}]);var approachServices=angular.module("ApproachServices",["ngResource"]);approachServices.factory("Approach",["$resource","Utility",function(a){var b={};return b.resource=a("/approach/"),b.pageProp=function(a){return void 0===a?{viewMode:1,pageTitle:"登録"}:{viewMode:2,pageTitle:"更新"}},b.getInfomation=function(a){var b={};return 1===a?(b.title="1日の制限回数について",b.message="対象の顧客に対して1日に抽出対象とする回数になります。<br>複数のシナリオで抽出対象となる顧客の場合この回数以上は抽出されなくなります。"):2===a&&(b.title="1週間の制限回数について",b.message="対象の顧客に対して1週間に抽出対象とする回数"),b},b}]);var uesrServices=angular.module("UesrServices",["ngResource"]);uesrServices.factory("User",["$resource","$http","$q","Utility",function(a,b,c){var d={},e={regist:{type:1,title:"ユーザー登録"},edit:{type:2,title:"ユーザー更新"}};return d.resource=a("/user/:id",{id:"@id"},{create:{method:"POST",url:"user/create"},remove:{method:"GET",url:"user/delete"}}),d.validators={isSameMailAddress:function(a,d){return b.post("user/mail/",{user_id:a,mailaddress:d}).then(function(a){return a.data.result.count>0?c.reject("exists"):!1})}},d.createBirth=function(a,b,c){return""!==a&&""!==b&&""!==c?a+"-"+b+"-"+c:""},d.getPrefectures=function(){return[{value:"01",text:"北海道"},{value:"02",text:"青森"},{value:"03",text:"岩手"},{value:"04",text:"宮城"},{value:"05",text:"秋田"},{value:"06",text:"山形"},{value:"07",text:"福島"},{value:"08",text:"茨城"},{value:"09",text:"栃木"},{value:"10",text:"群馬"},{value:"11",text:"埼玉"},{value:"12",text:"千葉"},{value:"13",text:"東京"},{value:"14",text:"神奈川"},{value:"15",text:"新潟"},{value:"16",text:"富山"},{value:"17",text:"石川"},{value:"18",text:"福井"},{value:"19",text:"山梨"},{value:"20",text:"長野"},{value:"21",text:"岐阜"},{value:"22",text:"静岡"},{value:"23",text:"愛知"},{value:"24",text:"三重"},{value:"25",text:"滋賀"},{value:"26",text:"京都"},{value:"27",text:"大阪"},{value:"28",text:"兵庫"},{value:"29",text:"奈良"},{value:"30",text:"和歌山"},{value:"31",text:"鳥取"},{value:"32",text:"島根"},{value:"33",text:"岡山"},{value:"34",text:"広島"},{value:"35",text:"山口"},{value:"36",text:"徳島"},{value:"37",text:"香川"},{value:"38",text:"愛媛"},{value:"39",text:"高知"},{value:"40",text:"福岡"},{value:"41",text:"佐賀"},{value:"42",text:"長崎"},{value:"43",text:"熊本"},{value:"44",text:"大分"},{value:"45",text:"宮崎"},{value:"46",text:"鹿児島"},{value:"47",text:"沖縄"}]},d.getPageProp=function(a){return void 0===a?e.regist:e.edit},d.getSelectedUserIdAndML=function(a,b){for(var c=[],d=a.length,e=0;d>e;e++)a[e][b]&&c.push({_id:a[e]._id,mailAddress:a[e].mailAddress});return c},d}]);var roleServices=angular.module("RoleServices",["ngResource"]);roleServices.factory("Role",["$resource","Utility",function(a){var b={};return b.resource=a("/role/:id",{id:"@id"},{}),b}]);var accessServices=angular.module("AccessServices",["ngResource"]);accessServices.factory("Access",["$resource","Utility",function(a){var b={};return b.resource=a("/access/",{},{day:{method:"POST",url:"/access"},dayByUser:{method:"POST",url:"/access/user"}}),b}]);var bugServices=angular.module("BugServices",["ngResource"]);bugServices.factory("Bug",["$resource","Utility","Upload",function(a,b,c){var d={};return d.categoryList=[{name:"ダッシュボード",type:1},{name:"トリガーシナリオ管理",type:2},{name:"スケジュールシナリオ管理",type:3},{name:"セグメント管理",type:4},{name:"クエリー管理",type:5},{name:"アプローチ管理",type:6},{name:"ユーザー管理",type:7},{name:"操作履歴",type:8},{name:"その他",type:99}],d.resource=a("/bug/",{},{getByConditon:{method:"POST",url:"/bug"},resolve:{method:"GET",url:"/bug/resolve/:id"},save:{method:"POST",url:"/bug/save"},saveComment:{method:"POST",url:"/bug/save/comment"},getComment:{method:"GET",url:"/bug/comment/:id"},vote:{method:"GET",url:"/bug/vote/:id"},download:{method:"GET",url:"/bug/download/:id"}}),d.commentSaveAndUpload=function(a,b,d){c.upload({url:"/bug/save/comment/upload/",file:a,data:{data:b}}).success(function(){d(null)}).error(function(){d("通信エラー")})},d.saveAndUpload=function(a,b,d){c.upload({url:"/bug/save/upload/",file:a,data:{data:b}}).success(function(){d(null)}).error(function(){d("通信エラー")})},d.addViewInfo=function(a){angular.forEach(a,function(a){switch(a.category){case 1:a.category_name="ダッシュボード";break;case 2:a.category_name="トリガーシナリオ管理";break;case 3:a.category_name="スケジュールシナリオ管理";break;case 4:a.category_name="セグメント管理";break;case 5:a.category_name="クエリー管理";break;case 6:a.category_name="アプローチ管理";break;case 7:a.category_name="ユーザー管理";break;case 8:a.category_name="操作履歴";break;default:a.category_name="その他"}a.type_name=1===a.type?"要望":"バグ",a.resolve_name=1===a.resolve?"解決":"未解決"})},d}]);var azureServices=angular.module("AzureServices",["ngResource"]);azureServices.factory("Azure",["$resource","$http","Shared",function(a){var b={};return b.resource=a("/customer/:id/",{id:"@id"},{recomender:{method:"GET",url:"/azure/recomender/:id"}}),b}]);var myApp=angular.module("myApp");myApp.controller("HeadCtrl",["$scope","Auth","Modal","Shared","Mail",function(a,b,c,d,e){a.initialize=function(){a.isShowUser=1==d.get("role")?!0:!1},a.addMenber=function(){a.modalParam={mailaddress:"",execute:f},a.modalInstance=c.open(a,"partials/memberAdd.html")},a.logout=function(){d.destloy(),b.logout().then(function(){$("#view").addClass("view-animate-container-wide"),$("#view").removeClass("view-animate-container"),a.$emit("logoutConplete")})};var f=function(){e.resource.save({site:"niikawa"}).$promise.then(function(){a.modalInstance.close()})}}]),myApp.directive("myHeader",function(){return{restrict:"E",replace:!0,controller:"HeadCtrl",templateUrl:"partials/common/header.html",link:function(a){a.isOpenMenu=!0,$("#view").removeClass("view-animate-container-wide"),$("#view").addClass("view-animate-container"),a.openClose=function(){a.isOpenMenu=!a.isOpenMenu,a.isOpenMenu?($("#view").removeClass("view-animate-container-wide"),$("#view").addClass("view-animate-container")):($("#view").removeClass("view-animate-container"),$("#view").addClass("view-animate-container-wide"))}}}});var myApp=angular.module("myApp");myApp.directive("autoCompleteDirective",function(){return{restrict:"E",scope:{selectedItem:"=",itemList:"=",execute:"&",namePropertie:"@",appendString:"@",showLabel:"=",selectByList:"=",selectName:"="},template:'<form class="navbar-form navbar-left"><input ng-show="!isLabel" class="form-control d-complete-input" ng-model="selectName"><span ng-show="isLabel && selectName.length != 0" ng-click="changeElement()">{{appendString}}{{selectName}}</span><ul class="complete-list" ng-show="isFocus"><li ng-repeat="item in itemList" ng-click="click($event, item)" >{{item[namePropertie]}}</li></ul></form>',replace:!0,link:function(a,b){a.selectName="",a.isFocus=!1,a.isLabel=!1;var c=[];a.$watch("itemList",function(b,d){if(void 0!==b&&void 0!==d){if(console.log("watch itemList"),b.length===d.length)return!1;b.length>d.length?c=angular.copy(b):b.length<d.length&&(c=angular.copy(d))}else void 0!==a.itemList&&(console.log("set initialize data"),angular.copy(a.itemList,c))}),b.find("input").on("focus",function(){0<a.itemList.length&&a.$apply(function(){a.isFocus=!0})}),b.find("input").on("blur",function(){var d=setInterval(function(){a.$apply(function(){if(a.selectByList){for(var d=c.length,e=0===a.selectName.length?!0:!1,f=0;d>f;f++)if(a.selectName===c[f][a.namePropertie]){e=!0;break}e?b.find("input").removeClass("auto-complete-item-error"):b.find("input").addClass("auto-complete-item-error"),a.isFocus=!1}}),clearInterval(d)},300)}),b.find("input").on("keyup",function(){0===c.length&&angular.copy(a.itemList,c);var b=[];if(0<a.itemList.length&&(a.isFocus=!0),0===a.selectName.length)angular.copy(c,b);else for(var d=c.length,e=0;d>e;e++)-1!==c[e][a.namePropertie].indexOf(a.selectName)&&b.push(angular.copy(c[e]));a.$apply(function(){angular.copy(b,a.itemList)})}),a.click=function(c,d){c.preventDefault(),c.stopPropagation(),angular.copy(d,a.selectedItem),b.find("input").removeClass("auto-complete-item-error"),a.isFocus=!1,void 0!==a.execute&&a.execute(),a.showLabel&&(a.isLabel=!0),a.selectName=d[a.namePropertie]},a.changeElement=function(){angular.copy(c,a.itemList),a.isLabel=!1,b.find("input").focus()}}}});var myApp=angular.module("myApp");myApp.directive("spinnerDirective",function(){return{restrict:"E",scope:{is:"=",src:"@"},template:'<div ng-show="is"><img ng-src="{{src}}"></div>',link:function(){}}});var myApp=angular.module("myApp");myApp.directive("mapDirective",["Utility",function(a){return{restrict:"AE",scope:{mapClass:"@",overlayClass:"@"},link:function(b,c,d){function e(b){var c=new GMaps({div:"#"+d.id,lat:b.coords.latitude,lng:b.coords.longitude,zoom:18});c.addMarker({lat:b.coords.latitude,lng:b.coords.longitude,animation:google.maps.Animation.BOUNCE,click:function(){var d=new google.maps.Geocoder,e=new google.maps.LatLng(b.coords.latitude,b.coords.longitude);d.geocode({latLng:e},function(b,d){d==google.maps.GeocoderStatus.OK&&b[1]?(a.info(b[1].formatted_address),c.setZoom(17)):a.warning("対象の住所は存在しません")})}})}function f(b){var c="";switch(b.code){case b.POSITION_UNAVAILABLE:c="位置情報の取得ができませんでした。";break;case b.PERMISSION_DENIED:c="位置情報取得の使用許可がされませんでした。";break;case b.PERMISSION_DENIED_TIMEOUT:c="位置情報取得中にタイムアウトしました。"}a.errorSticky(c)}return void 0===d.id?!1:navigator.geolocation?(c.addClass(b.mapClass),void navigator.geolocation.getCurrentPosition(e,f)):(a.errorSticky("ご利用のブラウザでは位置情報を取得できません。"),!1)}}}]);var myApp=angular.module("myApp");myApp.directive("drawerMenuDirective",function(){return{restrict:"E",scope:{menuList:"=",position:"@"},template:'<nav class="hi-icon-effect-8 drawer-menu"><a ng-repeat="item in itemList" style="{{item.style}}" class="drawer-menu-item" ng-href={{item.link}}><i ng-if="item.fa" class="fa {{item.fa}} fa-3x"></i><span ng-if="item.s">{{item.s}}</span></a></nav>',link:function(a,b){void 0===a.menuList&&console.log(a.menuList);var c=3.14,d=c-.2,e=5,f=1,g=50,h="fa-bars",i="fa-times",j=0,k=0,l=1e3;a.itemList=[],a.isOpen=!1;var m={fa:h,link:"",style:"#/"};a.itemList.push(m),b.on("click",function(){a.$apply(function(){if(a.isOpen)a.itemList[0].fa=h,a.itemList.splice(1,a.itemList.length-1),1===f&&(a.itemList[0].style="transform: translate(0);"),b.children("nav").addClass("drawer-menu-right"),b.children("nav").removeClass("drawer-menu-center");else{a.itemList[0].fa=i,b.children("nav").removeClass("drawer-menu-right"),b.children("nav").addClass("drawer-menu-center");var m=["","/#/segment","/#/scenario","/#/approach","/#/user"],n=["D","SE","SC","AP","US"];if(1===f)for(var o=1;e>=o;o++){var p=(c-d)/2+d/(e-1)*(o-1);j=75*Math.cos(p),k=75*Math.sin(p)-(o-1)*g-g/2;var q=l+400*o,r="transition-timing-function:cubic-bezier(0.935, 0.000, 0.340, 1.330);transition-duration: "+q+"ms;transform: translate3d("+j+"px,"+k+"px, 0);",s={s:n[o-1],link:m[o-1],style:r};a.itemList.push(s)}}a.isOpen=!a.isOpen})})}}});var dDSharedServices=angular.module("myApp");dDSharedServices.service("DDShared",function(){var a={},b=0,c={},d=0,e=!1;return a.setFrom=function(a){c=a},a.getFrom=function(){return c},a.getFromCopyByIndex=function(a){return angular.copy(c[a])},a.getCopyFrom=function(){return angular.copy(c)},a.setOrverIndex=function(a){b=a},a.getOrverIndex=function(){return b},a.getBeforePosition=function(){return d},a.setBeforePosition=function(a){d=a},a.isMoveDown=function(){return e},a.setMove=function(a){e=a>0?!0:!1},a.clear=function(){b=0,c={}},a});var myApp=angular.module("myApp");myApp.directive("dragItemDirective",["DDShared",function(a){return{restrict:"AE",transclude:!1,require:"^ngModel",scope:{dragindex:"="},link:function(b,c,d,e){c.attr("draggable",!0),c.attr("data-index",b.dragindex),c.on("dragstart",function(b){var d=b.target.dataset.index,f=c.html();b.originalEvent.dataTransfer.setData("item",f),b.originalEvent.dataTransfer.setData("itemIndex",d),a.setFrom(e.$modelValue),a.setBeforePosition(0)})}}}]),myApp.directive("dropDirective",["DDShared",function(a){return{restrict:"A",scope:{dropLineName:"@"},require:"^ngModel",link:function(b,c,d,e){var f=void 0===b.dropLineName||""===b.dropLineName?"line":b.dropLineName;c.on("dragenter",function(){c.addClass("ui-drop-target")}),c.on("dragover",function(b){if(b.preventDefault(),void 0!==b.target.dataset.index){a.setOrverIndex(b.target.dataset.index);var c=Math.max.apply(null,[document.body.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.documentElement.clientHeight]),d=window.innerHeight||document.body.clientHeight||0;if(c>d){var e=b.target.getBoundingClientRect().top+$(b.target).position().top+50,f=0;if(0!=a.getBeforePosition()&&a.getBeforePosition()!=e){var g=$(b.target).height()+15;f=a.getBeforePosition()>e?-g:g,a.setMove(f),a.setBeforePosition(e-f),$(window).scrollTop($(window).scrollTop()+f)}else a.setBeforePosition(e)}}b.originalEvent.dataTransfer.dropEffect="move"}),c.on("dragleave",function(){c.removeClass("ui-drop-target")}),c.on("drop",function(c){c.stopPropagation(),a.setBeforePosition(0);var g=c.originalEvent.dataTransfer.getData("itemIndex"),h={},i=0===e.$modelValue.length?0:a.getOrverIndex();if(g===i)return!1;angular.isArray(a.getFrom())?(h=a.getFromCopyByIndex(g),a.getFrom().splice(g,1)):h=a.getCopyFrom(),void 0!==h&&e.$modelValue.splice(i,0,h);for(var j=e.$modelValue.length,k=0;j>k;k++)e.$modelValue[k][f]=k+1;var l={to:{},from:{},remove:{},isSameContainer:!1,areaKey:d.dropAreaKey,insertLine:i};l.to=e.$modelValue,l.from=a.getFrom(),l.remove=h,l.isSameContainer=l.to==l.from,b.$emit("dropItemComplete",l),console.log(l),b.$$phase||b.$apply()})}}}]),myApp.directive("dropJoinDirective",["DDShared",function(a){return{restrict:"A",scope:{dropJoinIndex:"="},require:"^ngModel",link:function(b,c,d,e){c.on("dragenter",function(){c.addClass("ui-drop-target")}),c.on("dragover",function(b){b.preventDefault(),void 0!==b.target.dataset.index&&a.setOrverIndex(b.target.dataset.index),b.originalEvent.dataTransfer.dropEffect="move"}),c.on("dragleave",function(){c.removeClass("ui-drop-target")}),c.on("drop",function(c){if(c.stopPropagation(),e.$modelValue==a.getFrom())return!1;var d=c.originalEvent.dataTransfer.getData("itemIndex"),f=a.getFromCopyByIndex(d);if(void 0===f)return!1;var g=!1;if(console.log(e.$modelValue),angular.isArray(e.$modelValue)){if(e.$modelValue[0].hasOwnProperty("table")&&e.$modelValue[0].hasOwnProperty("column")&&e.$modelValue[0].table.physicalname==f[0].table.physicalname&&e.$modelValue[0].column.physicalname==f[0].column.physicalname)return!1;g=!0}if(angular.isArray(a.getFrom())?a.getFrom().splice(d,1):f=a.getCopyFrom(),e.$modelValue==a.getFrom())return console.log(d),e.$modelValue.splice(d,d+1,f,e.$modelValue[d+1]),!1;if(g)e.$modelValue.push(angular.isArray(f)?f[0]:f);else{var h=[];h.push(e.$modelValue),h.push(f)}e.$modelValue.isJoin=e.$modelValue.length>1?!0:!1,console.log(e.$modelValue),b.$$phase||b.$apply(),console.log("drop join complete")})}}}]);var myApp=angular.module("myApp");myApp.directive("pushDirective",function(){return{restrict:"A",scope:{list:"=",pushInfo:"=info",active:"=",activekey:"@",multiple:"="},link:function(a,b){if(b.css({cursor:"pointer"}),void 0!==a.active){var c=!1;"boolean"==typeof a.active?(a.pushInfo.isPush=a.active,c=a.active):("string"==typeof a.active||"number"==typeof a.active)&&a.pushInfo[a.activekey]==a.active&&(a.pushInfo.isPush=!0,c=!0),c&&b.addClass("push-active")}else a.pushInfo.isPush=!1;b.on("click",function(){a.$apply(function(){b.hasClass("push-active")?(a.pushInfo.isPush=!1,b.removeClass("push-active")):(void 0!==a.multiple&&a.multiple||(b.parent().children().removeClass("push-active"),angular.forEach(a.list,function(a){a.isPush=!1})),a.pushInfo.isPush=!0,b.addClass("push-active"))})})}}});var myApp=angular.module("myApp");myApp.directive("refineDirective",function(){return{restrict:"A",scope:{refineItem:"=",namePropertie:"@",keyword:"=",execute:"&"},replace:!0,link:function(a,b){var c=[];b.on("keyup",function(){0===c.length&&angular.copy(a.refineItem,c);var b=[];if(void 0===a.keyword||0===a.keyword.length)angular.copy(c,b);else for(var d=c.length,e=a.namePropertie.split("|"),f=[],g=Object.keys(c[0]),h=0;d>h;h++)angular.forEach(e,function(d){-1!==c[h][d].indexOf(a.keyword)&&void 0===f[c[h][g[0]]]&&(b.push(angular.copy(c[h])),f[c[h][g[0]]]=!0)});a.$apply(function(){angular.copy(b,a.refineItem)})})}}});var myApp=angular.module("myApp");myApp.directive("closeButtonDirecitve",function(a,b){return{restrict:"E",scope:{execute:"&"},template:'<button ng-if="isShowMine" class="close-button" ng-click="click()"><i class="fa fa-times"></i></button>',link:function(c){c.isShowMine=3!=a.get("role")?!0:!1,c.click=function(){b.confirmAlert(c.execute)}}}});var myApp=angular.module("myApp");myApp.directive("saveButtonDirecitve",function(a){return{restrict:"E",scope:{is:"=",execute:"&",name:"@"},template:'<button ng-if="is" class="close-button" ng-click="click()">{{name}}</button>',link:function(b){b.isShowMine=3!=a.get("role")?!0:!1,b.click=function(){b.execute()}}}});var myApp=angular.module("myApp");myApp.directive("linkButtonDirecitve",function(a){return{restrict:"E",scope:{href:"@",name:"@"},template:'<a ng-if="isShowMine" class="btn btn-default" ng-href="/#/{{href}}">{{name}}</a> ',link:function(b){b.isShowMine=3!=a.get("role")?!0:!1,b.click=function(){b.execute()}}}});var myApp=angular.module("myApp");myApp.directive("conditionDirective",function(a){return{restrict:"EA",scope:{conditionAppend:"=",screenType:"@"},template:'指定した値<select ng-model="mySlected" class="form-control" ng-options="item as item.name for item in selectItems" ng-required="true"></select>ものを条件とする<div ng-if="isOneInput"><input type="text" name="{{conditionAppend.column.physicalname}}" class="form-control" ng-model="conditionAppend.condition.value1" ng-keyup="check()" ng-required="true"><div ng-if="conditionAppend.error" class="item-error-box"><p class="item-error">{{conditionAppend.message}}</p></div></div><div ng-if="isTextArea"><textarea class="form-control" ng-model="conditionAppend.condition.value1" ng-required="true"></textarea></div><div ng-if="isTwoInput"><input type="text" class="form-control" ng-model="conditionAppend.condition.value1" ng-keyup="check()" ng-required="true">～<input type="text" class="form-control" ng-model="conditionAppend.condition.value2" ng-keyup="check()" ng-required="true"></div>',link:function(b,c){var d=function(){b.isOneInput=!0,b.isTextArea=!1,b.isTwoInput=!1},e=function(){b.isOneInput=!1,b.isTextArea=!0,b.isTwoInput=!1},f=function(){b.isOneInput=!1,b.isTextArea=!1,b.isTwoInput=!0};b.selectItems=1==b.screenType?[{name:"に等しい",value:1,execute:d,symbol:"="},{name:"以上",value:2,execute:d,symbol:">="},{name:"以下",value:3,execute:d,symbol:"<="},{name:"を超える",value:4,execute:d,symbol:">"},{name:"未満",value:5,execute:d,symbol:"<"},{name:"の間",value:6,execute:f,symbol:"BETWEEN"}]:[{name:"に等しい",value:1,execute:d,symbol:"="},{name:"以上",value:2,execute:d,symbol:">="},{name:"以下",value:3,execute:d,symbol:"<="},{name:"を超える",value:4,execute:d,symbol:">"},{name:"未満",value:5,execute:d,symbol:"<"},{name:"の間",value:6,execute:f,symbol:"BETWEEN"},{name:"を含む",value:7,execute:e,symbol:"IN"},{name:"を含まない",value:8,execute:e,symbol:"NOT IN"},{name:"から始まる",value:9,execute:d,symbol:"LIKE"},{name:"で終わる",value:10,execute:d,symbol:"LIKE"},{name:"を一部に持つ",value:11,execute:d,symbol:"LIKE"}],b.isOneInput=!1,b.isTextArea=!1,b.isTwoInput=!1,void 0===b.conditionAppend.selectedCondition?(b.conditionAppend.selectedCondition={name:"",value:"",symbol:""},b.conditionAppend.condition={value1:"",value2:"",where:"AND"}):angular.forEach(b.selectItems,function(a){return a.value===b.conditionAppend.selectedCondition.value?(b.mySlected=a,b.conditionAppend.selectedCondition.name=b.mySlected.name,b.conditionAppend.selectedCondition.value=b.mySlected.value,b.conditionAppend.selectedCondition.symbol=b.mySlected.symbol,a.execute(),!1):void 0}),c.find("select").on("change",function(){b.conditionAppend.selectedCondition.name=b.mySlected.name,b.conditionAppend.selectedCondition.value=b.mySlected.value,b.conditionAppend.selectedCondition.symbol=b.mySlected.symbol,b.$apply(function(){b.mySlected.execute()})}),b.check=function(){var c="";c=void 0===b.conditionAppend.column?b.conditionAppend.type:b.conditionAppend.column.type;var d=b.conditionAppend.condition.value1;if("bigint"===c||"int"===c||"number"===c)void 0===d?(b.conditionAppend.error=!1,b.conditionAppend.message=""):isFinite(parseInt(d,10))?(b.conditionAppend.error=!1,b.conditionAppend.message=""):(b.conditionAppend.error=!0,b.conditionAppend.message="数値で入力してください");else if("datetime"===c||"smalldatetime"===c)if(void 0===d)b.conditionAppend.error=!1,b.conditionAppend.message="";else{var e=d.split("-");if(3!==e.length)b.conditionAppend.error=!0,b.conditionAppend.message="日付はYYYY-MM-DDで入力してください";else{var f=a.moment(d);f.isValid()?(b.conditionAppend.error=!1,b.conditionAppend.message=""):(b.conditionAppend.error=!0,b.conditionAppend.message="有効な日付ではありません")}}}}}});var myApp=angular.module("myApp");myApp.directive("autoCompleteFaDirective",function(){return{restrict:"E",scope:{selectedItem:"=",itemList:"=",execute:"&",clickExecute:"&",namePropertie:"@",appendString:"@",showLabel:"=",selectByList:"=",selectName:"=",addonString:"@"},template:'<div class="input-group"><span class="input-group-addon">{{addonString}}</span><input ng-show="!isLabel" class="form-control form-control-add-fa2 " ng-model="selectName"><span ng-show="isLabel && selectName.length != 0" ng-click="changeElement()">{{appendString}}{{selectName}}</span><ul class="complete-list" ng-show="isFocus"><li ng-repeat="item in itemList" ng-click="click($event, item)" >{{item[namePropertie]}}</li></ul><span class="input-group-addon question"><i class="fa fa-plus fa-2x" ng-click="clickI()"></i></span>',replace:!0,link:function(a,b){a.selectName="",a.isFocus=!1,a.isLabel=!1;var c=[];a.$watch("itemList",function(b,d){if(void 0!==b&&void 0!==d){if(console.log("watch itemList"),b.length===d.length)return!1;b.length>d.length?c=angular.copy(b):b.length<d.length&&(c=angular.copy(d))}else void 0!==a.itemList&&(console.log("set initialize data"),angular.copy(a.itemList,c))}),b.find("input").on("focus",function(){0<a.itemList.length&&a.$apply(function(){a.isFocus=!0})}),b.find("input").on("blur",function(){var d=setInterval(function(){a.$apply(function(){if(a.selectByList){for(var d=c.length,e=0===a.selectName.length?!0:!1,f=0;d>f;f++)if(a.selectName===c[f][a.namePropertie]){
e=!0;break}e?b.find("input").removeClass("auto-complete-item-error"):b.find("input").addClass("auto-complete-item-error"),a.isFocus=!1}}),clearInterval(d)},300)}),b.find("input").on("keyup",function(){0===c.length&&angular.copy(a.itemList,c);var b=[];if(0<a.itemList.length&&(a.isFocus=!0),0===a.selectName.length)angular.copy(c,b);else for(var d=c.length,e=0;d>e;e++)-1!==c[e][a.namePropertie].indexOf(a.selectName)&&b.push(angular.copy(c[e]));a.$apply(function(){angular.copy(b,a.itemList)})}),a.click=function(c,d){c.preventDefault(),c.stopPropagation(),angular.copy(d,a.selectedItem),b.find("input").removeClass("auto-complete-item-error"),a.isFocus=!1,void 0!==a.execute&&a.execute(),a.showLabel&&(a.isLabel=!0),a.selectName=d[a.namePropertie]},a.changeElement=function(){angular.copy(c,a.itemList),a.isLabel=!1,b.find("input").focus()},a.clickI=function(){angular.copy(c,a.itemList),a.isFocus=!1,a.clickExecute()}}}});var myApp=angular.module("myApp");myApp.controller("CalendarCtrl",["$scope","Calendar","Utility",function(a,b,c){a.calendarList=[],a.calendarofMonthList=[],a.isWeek=!1,a.isMonth=!1;var d=!1;a.initialize=function(){b.resource.get().$promise.then(function(b){a.isWeek=!0,a.calendarList=b.data})},a.nextDay=function(){if(!d){d=!0;var e=Object.keys(a.calendarList),f=c.moment(e[e.length-1]).format("YYYY-MM-DD"),g=c.addDay(f,1).format("YYYY-MM-DD");b.resource.oneDay({day:g}).$promise.then(function(b){delete a.calendarList[Object.keys(a.calendarList)[0]];var c=Object.keys(b.data);a.calendarList[c]=b.data[c],d=!1})}},a.deforeDay=function(){if(!d){d=!0;var e=c.moment(Object.keys(a.calendarList)[0]).format("YYYY-MM-DD"),f=c.subtractDay(e,1).format("YYYY-MM-DD");b.resource.oneDay({day:f}).$promise.then(function(b){var c=Object.keys(a.calendarList);delete a.calendarList[c[c.length-1]];var e=Object.keys(b.data),f={};f[e]=b.data[e],Object.keys(a.calendarList).forEach(function(b){f[b]=a.calendarList[b]}),a.calendarList=f,d=!1})}},a.showWeek=function(){d||(d=!0,b.resource.get().$promise.then(function(b){d=!1,a.isWeek=!0,a.isMonth=!1,a.calendarList=b.data}))},a.showMonth=function(){if(!d){d=!0;var e=Object.keys(a.calendarList),f=c.moment(e[e.length-1]).format("YYYY"),g=c.moment(e[e.length-1]).format("MM");b.resource.month({year:f,month:g}).$promise.then(function(b){d=!1,a.isMonth=!0,a.isWeek=!1,a.calendarofMonthList=b.data,a.year=b.year,a.month=b.month})}},a.nextMonth=function(){if(!d){d=!0;var e=a.year+"/"+a.month+"/01",f=c.addMonth(e,1).format("YYYY-MM"),g=f.split("-");b.resource.month({year:g[0],month:g[1]}).$promise.then(function(b){d=!1,a.isWeek=!1,a.isMonth=!0,a.calendarofMonthList=b.data,a.year=b.year,a.month=b.month})}},a.deforeMonth=function(){if(!d){d=!0;var e=a.year+"/"+a.month+"/01",f=c.subtractMonth(e,1).format("YYYY-MM"),g=f.split("-");b.resource.month({year:g[0],month:g[1]}).$promise.then(function(b){d=!1,a.isWeek=!1,a.isMonth=!0,a.calendarofMonthList=b.data,a.year=b.year,a.month=b.month})}}}]),myApp.factory("Calendar",["$resource","Utility",function(a){var b={};return b.resource=a("/calendar/",{},{oneDay:{method:"GET",url:"calendar/one/:day"},month:{method:"GET",url:"calendar/:year/:month"}}),b}]),myApp.directive("calendarDirective",function(a){return{restrict:"E",templateUrl:"../../partials/calendar.html",controller:"CalendarCtrl",replace:!0,link:function(b){b.showCircle=!1,b.enterCircle=function(){b.showCircle=!0},b.leaveCircle=function(){b.showCircle=!1},b.isTrigger=function(a){return 1===a},b.isScSingle=function(a){return 2===a},b.isScPriod=function(a){return 3===a},b.isHoliday=function(a){return"0sun"==a},b.isHolidayToWeek=function(b){return 0==a.moment(b).format("e")}}}});var myApp=angular.module("myApp");myApp.directive("myValidators",function(){return{require:"ngModel",scope:{myValidators:"="},link:function(a,b,c,d){var e=a.myValidators||{};angular.forEach(e,function(a,b){d.$validators[b]=a})}}}),myApp.directive("myAsyncValidators",function(){return{require:"ngModel",scope:{myAsyncValidators:"="},link:function(a,b,c,d){var e=a.myAsyncValidators||{};angular.forEach(e,function(a,b){d.$asyncValidators[b]=a})}}});var myApp=angular.module("myApp");myApp.directive("d3Bar",["d3Service","$parse",function(a,b){var c=a.d3;return{restrict:"EAC",scope:{data:"=",key:"@",valueProp:"@",label:"@"},link:function(a,d){var e=c.select(d[0]).append("svg").style("width","100%"),f=c.scale.category20(),g={},h=b(a.key||"id"),i=b(a.valueProp||"value"),j=b(a.label||"name");a.$watchCollection("data",function(){if(a.data){var b=e.selectAll("g.data-group").data(a.data,h),d=b.enter().append("g").classed("data-group",!0).each(function(b){var d=c.select(this);g[h(b)]=a.$watch(function(){return i(b)},function(a){d.select("rect").attr("width",a)})});d.append("rect").attr("x",130).attr("height",18).attr("fill",function(a){return f(a.name)}),d.append("text").text(j).attr("height",15),b.exit().each(function(a){var b=h(a);g[b](),delete g[b]}).remove(),b.each(function(a,b){var d=c.select(this);d.select("rect").attr("y",25*b),d.select("text").attr("y",25*b+15)})}})}}}]);var myApp=angular.module("myApp");myApp.directive("lineChart",["d3Service","$parse","$window",function(a,b,c){var d=a.d3;return{restrict:"EA",scope:{data:"=",type:"@",headerLabel:"=",legendLabel:"="},link:function(a,b){function e(a){return-1===k.indexOf(a)?k[0]:a}function f(){if(void 0!==a.legendLabel){var c=angular.isArray(a.legendLabel)?a.legendLabel.length:0;if(0!==c){var e={width:"100%",height:15*c},f=d.select(b[0]).append("svg").attr("width",e.width).attr("height",e.height);f.selectAll("rect").data(a.legendLabel).enter().append("rect").attr("class","pull-right").attr("width",50).attr("height",5).attr("x",i.width()-150).attr("y",function(a,b){return 20*b}).attr("fill",function(a,b){return j[b]}),f.selectAll("text").data(a.legendLabel).enter().append("text").text(function(a){return a}).attr("x",function(){return i.width()-250}).attr("y",function(a,b){return 0===b?10:5*b+20})}}}function g(c){var f={width:i.width(),height:i.height()/2},g=f.width-l.left-l.right-50,h=f.height-l.top-l.bottom,j=d.time.scale().range([0,g]),k=d.scale.linear().range([h,0]),n=d.svg.axis().scale(j).orient("bottom").innerTickSize(-h).outerTickSize(0).tickFormat(d.time.format("%Y/%m")),o=d.svg.axis().scale(k).orient("left").innerTickSize(-g).outerTickSize(0),p=d.select(b[0]).append("svg").attr("width","100%").attr("height",f.height).append("g").attr("transform","translate("+l.left+","+l.top+")"),q=e(a.type),r=d.svg.line().x(function(a){return j(a.date)}).y(function(a){return k(a.price)}).interpolate(q);angular.forEach(a.data,function(a,b){a.forEach(c?function(a){a.date=a.date,a.price=+a.price}:function(a){a.date=m(a.date),a.price=+a.price});var e="line-avg";0===b&&(e="line-main",j.domain(d.extent(a,function(a){return a.date})).nice(),k.domain(d.extent(a,function(a){return a.price})).nice(),p.append("g").attr("class","x axis").attr("transform","translate(0, "+(f.height-l.top-l.bottom)+")").call(n).selectAll("text").attr("transform","rotate (-70)").attr("dx","-5em").attr("dy","-0.1em").style("text-anchor","start"),p.append("g").attr("class","y axis").call(o).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".7em").style("text-anchor","end")),p.append("path").datum(a).attr("class",e).attr("d",r)})}function h(){b.children("svg").length>0&&b.children("svg").remove()}var i=angular.element(c),j=["#FF8C00","#A9A9A9"],k=["linear","linear-closed","step","step-before","step-after","basis","basis-open","basis-close","bundle","cardinal","cardinal-open","cardinal-close","monotone"],l={top:40,right:40,bottom:70,left:90},m=d.time.format("%Y/%m").parse;a.$watchCollection("data",function(){if(void 0!==a.headerLabel&&""!==a.headerLabel){b.children("p").length>0&&b.children("p").remove();var c='<p class="line-title">'+a.headerLabel+"</p>";b.append(c)}a.data&&(h(),f(!1),g(!1))}),i.on("resize",function(){h(),f(!0),g(!0)})}}}]);