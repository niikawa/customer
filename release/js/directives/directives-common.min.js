var myApp=angular.module("myApp");myApp.controller("HeadCtrl",["$scope","Auth","Modal","Shared","Mail",function(a,b,c,d,e){a.initialize=function(){a.isShowUser=1==d.get("role")?!0:!1},a.addMenber=function(){a.modalParam={mailaddress:"",execute:f},a.modalInstance=c.open(a,"partials/memberAdd.html")},a.logout=function(){d.destloy(),b.logout().then(function(){$("#view").addClass("view-animate-container-wide"),$("#view").removeClass("view-animate-container"),a.$emit("logoutConplete")})};var f=function(){e.resource.save({site:"niikawa"}).$promise.then(function(){a.modalInstance.close()})}}]),myApp.directive("myHeader",function(){return{restrict:"E",replace:!0,controller:"HeadCtrl",templateUrl:"partials/common/header.html",link:function(a){a.isOpenMenu=!0,$("#view").removeClass("view-animate-container-wide"),$("#view").addClass("view-animate-container"),a.openClose=function(){a.isOpenMenu=!a.isOpenMenu,a.isOpenMenu?($("#view").removeClass("view-animate-container-wide"),$("#view").addClass("view-animate-container")):($("#view").removeClass("view-animate-container"),$("#view").addClass("view-animate-container-wide"))}}}});var myApp=angular.module("myApp");myApp.directive("spinnerDirective",function(){return{restrict:"E",scope:{is:"=",src:"@"},template:'<div ng-show="is"><img ng-src="{{src}}"></div>',link:function(){}}});var myApp=angular.module("myApp");myApp.directive("closeButtonDirecitve",["Shared","Utility",function(a,b){return{restrict:"E",scope:{execute:"&"},template:'<button ng-if="isShowMine" class="close-button" ng-click="click()"><i class="fa fa-times"></i></button>',link:function(c){c.isShowMine=3!=a.get("role")?!0:!1,c.click=function(){b.confirmAlert(c.execute)}}}}]);var myApp=angular.module("myApp");myApp.directive("linkButtonDirecitve",["Shared",function(a){return{restrict:"E",scope:{href:"@",name:"@"},template:'<a ng-if="isShowMine" class="btn btn-default" ng-href="/#/{{href}}">{{name}}</a> ',link:function(b){b.isShowMine=3!=a.get("role")?!0:!1,b.click=function(){b.execute()}}}}]);var myApp=angular.module("myApp");myApp.directive("pushDirective",function(){return{restrict:"A",scope:{list:"=",pushInfo:"=info",active:"=",activekey:"@",multiple:"="},link:function(a,b){if(b.css({cursor:"pointer"}),void 0!==a.active){var c=!1;"boolean"==typeof a.active?(a.pushInfo.isPush=a.active,c=a.active):("string"==typeof a.active||"number"==typeof a.active)&&a.pushInfo[a.activekey]==a.active&&(a.pushInfo.isPush=!0,c=!0),c&&b.addClass("push-active")}else a.pushInfo.isPush=!1;b.on("click",function(){a.$apply(function(){b.hasClass("push-active")?(a.pushInfo.isPush=!1,b.removeClass("push-active")):(void 0!==a.multiple&&a.multiple||(b.parent().children().removeClass("push-active"),angular.forEach(a.list,function(a){a.isPush=!1})),a.pushInfo.isPush=!0,b.addClass("push-active"))})})}}});var myApp=angular.module("myApp");myApp.directive("autoCompleteDirective",function(){return{restrict:"E",scope:{selectedItem:"=",itemList:"=",execute:"&",namePropertie:"@",appendString:"@",showLabel:"=",selectByList:"=",selectName:"="},template:'<form class="navbar-form navbar-left"><input ng-show="!isLabel" class="form-control d-complete-input" ng-model="selectName"><span ng-show="isLabel && selectName.length != 0" ng-click="changeElement()">{{appendString}}{{selectName}}</span><ul class="complete-list" ng-show="isFocus"><li ng-repeat="item in itemList" ng-click="click($event, item)" >{{item[namePropertie]}}</li></ul></form>',replace:!0,link:function(a,b){a.selectName="",a.isFocus=!1,a.isLabel=!1;var c=[];a.$watch("itemList",function(b,d){if(void 0!==b&&void 0!==d){if(console.log("watch itemList"),b.length===d.length)return!1;b.length>d.length?c=angular.copy(b):b.length<d.length&&(c=angular.copy(d))}else void 0!==a.itemList&&(console.log("set initialize data"),angular.copy(a.itemList,c))}),b.find("input").on("focus",function(){0<a.itemList.length&&a.$apply(function(){a.isFocus=!0})}),b.find("input").on("blur",function(){var d=setInterval(function(){a.$apply(function(){if(a.selectByList){for(var d=c.length,e=0===a.selectName.length?!0:!1,f=0;d>f;f++)if(a.selectName===c[f][a.namePropertie]){e=!0;break}e?b.find("input").removeClass("auto-complete-item-error"):b.find("input").addClass("auto-complete-item-error"),a.isFocus=!1}}),clearInterval(d)},300)}),b.find("input").on("keyup",function(){0===c.length&&angular.copy(a.itemList,c);var b=[];if(0<a.itemList.length&&(a.isFocus=!0),0===a.selectName.length)angular.copy(c,b);else for(var d=c.length,e=0;d>e;e++)-1!==c[e][a.namePropertie].indexOf(a.selectName)&&b.push(angular.copy(c[e]));a.$apply(function(){angular.copy(b,a.itemList)})}),a.click=function(c,d){c.preventDefault(),c.stopPropagation(),angular.copy(d,a.selectedItem),b.find("input").removeClass("auto-complete-item-error"),a.isFocus=!1,void 0!==a.execute&&a.execute(),a.showLabel&&(a.isLabel=!0),a.selectName=d[a.namePropertie]},a.changeElement=function(){angular.copy(c,a.itemList),a.isLabel=!1,b.find("input").focus()}}}});var myApp=angular.module("myApp");myApp.directive("refineDirective",function(){return{restrict:"A",scope:{refineItem:"=",namePropertie:"@",keyword:"=",execute:"&"},replace:!0,link:function(a,b){var c=[];b.on("keyup",function(){0===c.length&&angular.copy(a.refineItem,c);var b=[];if(void 0===a.keyword||0===a.keyword.length)angular.copy(c,b);else for(var d=c.length,e=a.namePropertie.split("|"),f=[],g=Object.keys(c[0]),h=0;d>h;h++)angular.forEach(e,function(d){-1!==c[h][d].indexOf(a.keyword)&&void 0===f[c[h][g[0]]]&&(b.push(angular.copy(c[h])),f[c[h][g[0]]]=!0)});a.$apply(function(){angular.copy(b,a.refineItem)})})}}});var dDSharedServices=angular.module("myApp");dDSharedServices.service("DDShared",function(){var a={},b=0,c={},d=0,e=!1;return a.setFrom=function(a){c=a},a.getFrom=function(){return c},a.getFromCopyByIndex=function(a){return angular.copy(c[a])},a.getCopyFrom=function(){return angular.copy(c)},a.setOrverIndex=function(a){b=a},a.getOrverIndex=function(){return b},a.getBeforePosition=function(){return d},a.setBeforePosition=function(a){d=a},a.isMoveDown=function(){return e},a.setMove=function(a){e=a>0?!0:!1},a.clear=function(){b=0,c={}},a});var myApp=angular.module("myApp");myApp.directive("dragItemDirective",["DDShared",function(a){return{restrict:"AE",transclude:!1,require:"^ngModel",scope:{dragindex:"="},link:function(b,c,d,e){c.attr("draggable",!0),c.attr("data-index",b.dragindex),c.on("dragstart",function(b){var d=b.target.dataset.index,f=c.html();b.originalEvent.dataTransfer.setData("item",f),b.originalEvent.dataTransfer.setData("itemIndex",d),a.setFrom(e.$modelValue),a.setBeforePosition(0)})}}}]),myApp.directive("dropDirective",["DDShared",function(a){return{restrict:"A",scope:{dropLineName:"@"},require:"^ngModel",link:function(b,c,d,e){var f=void 0===b.dropLineName||""===b.dropLineName?"line":b.dropLineName;c.on("dragenter",function(){c.addClass("ui-drop-target")}),c.on("dragover",function(b){if(b.preventDefault(),void 0!==b.target.dataset.index){a.setOrverIndex(b.target.dataset.index);var c=Math.max.apply(null,[document.body.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.documentElement.clientHeight]),d=window.innerHeight||document.body.clientHeight||0;if(c>d){var e=b.target.getBoundingClientRect().top+$(b.target).position().top+50,f=0;if(0!=a.getBeforePosition()&&a.getBeforePosition()!=e){var g=$(b.target).height()+15;f=a.getBeforePosition()>e?-g:g,a.setMove(f),a.setBeforePosition(e-f),$(window).scrollTop($(window).scrollTop()+f)}else a.setBeforePosition(e)}}b.originalEvent.dataTransfer.dropEffect="move"}),c.on("dragleave",function(){c.removeClass("ui-drop-target")}),c.on("drop",function(c){c.stopPropagation(),a.setBeforePosition(0);var g=c.originalEvent.dataTransfer.getData("itemIndex"),h={},i=0===e.$modelValue.length?0:a.getOrverIndex();if(g===i)return!1;angular.isArray(a.getFrom())?(h=a.getFromCopyByIndex(g),a.getFrom().splice(g,1)):h=a.getCopyFrom(),void 0!==h&&e.$modelValue.splice(i,0,h);for(var j=e.$modelValue.length,k=0;j>k;k++)e.$modelValue[k][f]=k+1;var l={to:{},from:{},remove:{},isSameContainer:!1,areaKey:d.dropAreaKey,insertLine:i};l.to=e.$modelValue,l.from=a.getFrom(),l.remove=h,l.isSameContainer=l.to==l.from,b.$emit("dropItemComplete",l),console.log(l),b.$$phase||b.$apply()})}}}]),myApp.directive("dropJoinDirective",["DDShared",function(a){return{restrict:"A",scope:{dropJoinIndex:"="},require:"^ngModel",link:function(b,c,d,e){c.on("dragenter",function(){c.addClass("ui-drop-target")}),c.on("dragover",function(b){b.preventDefault(),void 0!==b.target.dataset.index&&a.setOrverIndex(b.target.dataset.index),b.originalEvent.dataTransfer.dropEffect="move"}),c.on("dragleave",function(){c.removeClass("ui-drop-target")}),c.on("drop",function(c){if(c.stopPropagation(),e.$modelValue==a.getFrom())return!1;var d=c.originalEvent.dataTransfer.getData("itemIndex"),f=a.getFromCopyByIndex(d);if(void 0===f)return!1;var g=!1;if(console.log(e.$modelValue),angular.isArray(e.$modelValue)){if(e.$modelValue[0].hasOwnProperty("table")&&e.$modelValue[0].hasOwnProperty("column")&&e.$modelValue[0].table.physicalname==f[0].table.physicalname&&e.$modelValue[0].column.physicalname==f[0].column.physicalname)return!1;g=!0}if(angular.isArray(a.getFrom())?a.getFrom().splice(d,1):f=a.getCopyFrom(),e.$modelValue==a.getFrom())return console.log(d),e.$modelValue.splice(d,d+1,f,e.$modelValue[d+1]),!1;if(g)e.$modelValue.push(angular.isArray(f)?f[0]:f);else{var h=[];h.push(e.$modelValue),h.push(f)}e.$modelValue.isJoin=e.$modelValue.length>1?!0:!1,console.log(e.$modelValue),b.$$phase||b.$apply(),console.log("drop join complete")})}}}]);var myApp=angular.module("myApp");myApp.directive("myValidators",function(){return{require:"ngModel",scope:{myValidators:"="},link:function(a,b,c,d){var e=a.myValidators||{};angular.forEach(e,function(a,b){d.$validators[b]=a})}}}),myApp.directive("myAsyncValidators",function(){return{require:"ngModel",scope:{myAsyncValidators:"="},link:function(a,b,c,d){var e=a.myAsyncValidators||{};angular.forEach(e,function(a,b){d.$asyncValidators[b]=a})}}});