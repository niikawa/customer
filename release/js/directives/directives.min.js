var myApp=angular.module("myApp");myApp.controller("CalendarCtrl",["$scope","Calendar","Utility",function(a,b,c){a.calendarList=[],a.calendarofMonthList=[],a.isWeek=!1,a.isMonth=!1;var d=!1;a.initialize=function(){b.resource.get().$promise.then(function(b){a.isWeek=!0,a.calendarList=b.data})},a.nextDay=function(){if(!d){d=!0;var e=Object.keys(a.calendarList),f=c.moment(e[e.length-1]).format("YYYY-MM-DD"),g=c.addDay(f,1).format("YYYY-MM-DD");b.resource.oneDay({day:g}).$promise.then(function(b){delete a.calendarList[Object.keys(a.calendarList)[0]];var c=Object.keys(b.data);a.calendarList[c]=b.data[c],d=!1})}},a.deforeDay=function(){if(!d){d=!0;var e=c.moment(Object.keys(a.calendarList)[0]).format("YYYY-MM-DD"),f=c.subtractDay(e,1).format("YYYY-MM-DD");b.resource.oneDay({day:f}).$promise.then(function(b){var c=Object.keys(a.calendarList);delete a.calendarList[c[c.length-1]];var e=Object.keys(b.data),f={};f[e]=b.data[e],Object.keys(a.calendarList).forEach(function(b){f[b]=a.calendarList[b]}),a.calendarList=f,d=!1})}},a.showWeek=function(){d||(d=!0,b.resource.get().$promise.then(function(b){d=!1,a.isWeek=!0,a.isMonth=!1,a.calendarList=b.data}))},a.showMonth=function(){if(!d){d=!0;var e=Object.keys(a.calendarList),f=c.moment(e[e.length-1]).format("YYYY"),g=c.moment(e[e.length-1]).format("MM");b.resource.month({year:f,month:g}).$promise.then(function(b){d=!1,a.isMonth=!0,a.isWeek=!1,a.calendarofMonthList=b.data,a.year=b.year,a.month=b.month})}},a.nextMonth=function(){if(!d){d=!0;var e=a.year+"/"+a.month+"/01",f=c.addMonth(e,1).format("YYYY-MM"),g=f.split("-");b.resource.month({year:g[0],month:g[1]}).$promise.then(function(b){d=!1,a.isWeek=!1,a.isMonth=!0,a.calendarofMonthList=b.data,a.year=b.year,a.month=b.month})}},a.deforeMonth=function(){if(!d){d=!0;var e=a.year+"/"+a.month+"/01",f=c.subtractMonth(e,1).format("YYYY-MM"),g=f.split("-");b.resource.month({year:g[0],month:g[1]}).$promise.then(function(b){d=!1,a.isWeek=!1,a.isMonth=!0,a.calendarofMonthList=b.data,a.year=b.year,a.month=b.month})}}}]),myApp.factory("Calendar",["$resource","Utility",function(a){var b={};return b.resource=a("/calendar/",{},{oneDay:{method:"GET",url:"calendar/one/:day"},month:{method:"GET",url:"calendar/:year/:month"}}),b}]),myApp.directive("calendarDirective",["Utility",function(a){return{restrict:"E",templateUrl:"../../partials/calendar.html",controller:"CalendarCtrl",link:function(b){b.showCircle=!1,b.enterCircle=function(){b.showCircle=!0},b.leaveCircle=function(){b.showCircle=!1},b.isTrigger=function(a){return 1===a},b.isScSingle=function(a){return 2===a},b.isScPriod=function(a){return 3===a},b.isHoliday=function(a){return"0sun"==a},b.isHolidayToWeek=function(b){return 0==a.moment(b).format("e")}}}}]);var myApp=angular.module("myApp");myApp.directive("conditionDirective",["Utility",function(a){return{restrict:"EA",scope:{conditionAppend:"=",screenType:"@"},template:'指定した値<select ng-model="mySlected" class="form-control" ng-options="item as item.name for item in selectItems" ng-required="true"></select>ものを条件とする<div ng-if="isOneInput"><input type="text" name="{{conditionAppend.column.physicalname}}" class="form-control" ng-model="conditionAppend.condition.value1" ng-keyup="check()" ng-required="true"><div ng-if="conditionAppend.error" class="item-error-box"><p class="item-error">{{conditionAppend.message}}</p></div></div><div ng-if="isTextArea"><textarea class="form-control" ng-model="conditionAppend.condition.value1" ng-required="true"></textarea></div><div ng-if="isTwoInput"><input type="text" class="form-control" ng-model="conditionAppend.condition.value1" ng-keyup="check()" ng-required="true">～<input type="text" class="form-control" ng-model="conditionAppend.condition.value2" ng-keyup="check()" ng-required="true"></div>',link:function(b,c){var d=function(){b.isOneInput=!0,b.isTextArea=!1,b.isTwoInput=!1},e=function(){b.isOneInput=!1,b.isTextArea=!0,b.isTwoInput=!1},f=function(){b.isOneInput=!1,b.isTextArea=!1,b.isTwoInput=!0};b.selectItems=1==b.screenType?[{name:"に等しい",value:1,execute:d,symbol:"="},{name:"以上",value:2,execute:d,symbol:">="},{name:"以下",value:3,execute:d,symbol:"<="},{name:"を超える",value:4,execute:d,symbol:">"},{name:"未満",value:5,execute:d,symbol:"<"},{name:"の間",value:6,execute:f,symbol:"BETWEEN"}]:[{name:"に等しい",value:1,execute:d,symbol:"="},{name:"以上",value:2,execute:d,symbol:">="},{name:"以下",value:3,execute:d,symbol:"<="},{name:"を超える",value:4,execute:d,symbol:">"},{name:"未満",value:5,execute:d,symbol:"<"},{name:"の間",value:6,execute:f,symbol:"BETWEEN"},{name:"を含む",value:7,execute:e,symbol:"IN"},{name:"を含まない",value:8,execute:e,symbol:"NOT IN"},{name:"から始まる",value:9,execute:d,symbol:"LIKE"},{name:"で終わる",value:10,execute:d,symbol:"LIKE"},{name:"を一部に持つ",value:11,execute:d,symbol:"LIKE"}],b.isOneInput=!1,b.isTextArea=!1,b.isTwoInput=!1,void 0===b.conditionAppend.selectedCondition?(b.conditionAppend.selectedCondition={name:"",value:"",symbol:""},b.conditionAppend.condition={value1:"",value2:"",where:"AND"}):angular.forEach(b.selectItems,function(a){return a.value===b.conditionAppend.selectedCondition.value?(b.mySlected=a,b.conditionAppend.selectedCondition.name=b.mySlected.name,b.conditionAppend.selectedCondition.value=b.mySlected.value,b.conditionAppend.selectedCondition.symbol=b.mySlected.symbol,a.execute(),!1):void 0}),c.find("select").on("change",function(){b.conditionAppend.selectedCondition.name=b.mySlected.name,b.conditionAppend.selectedCondition.value=b.mySlected.value,b.conditionAppend.selectedCondition.symbol=b.mySlected.symbol,b.$apply(function(){b.mySlected.execute()})}),b.check=function(){var c="";c=void 0===b.conditionAppend.column?b.conditionAppend.type:b.conditionAppend.column.type;var d=b.conditionAppend.condition.value1;if("bigint"===c||"int"===c||"number"===c)void 0===d?(b.conditionAppend.error=!1,b.conditionAppend.message=""):isFinite(parseInt(d,10))?(b.conditionAppend.error=!1,b.conditionAppend.message=""):(b.conditionAppend.error=!0,b.conditionAppend.message="数値で入力してください");else if("datetime"===c||"smalldatetime"===c)if(void 0===d)b.conditionAppend.error=!1,b.conditionAppend.message="";else{var e=d.split("-");if(3!==e.length)b.conditionAppend.error=!0,b.conditionAppend.message="日付はYYYY-MM-DDで入力してください";else{var f=a.moment(d);f.isValid()?(b.conditionAppend.error=!1,b.conditionAppend.message=""):(b.conditionAppend.error=!0,b.conditionAppend.message="有効な日付ではありません")}}}}}}]);var myApp=angular.module("myApp");myApp.directive("autoCompleteFaDirective",function(){return{restrict:"E",scope:{selectedItem:"=",itemList:"=",execute:"&",clickExecute:"&",namePropertie:"@",appendString:"@",showLabel:"=",selectByList:"=",selectName:"=",addonString:"@"},template:'<div class="input-group"><span class="input-group-addon">{{addonString}}</span><input ng-show="!isLabel" class="form-control form-control-add-fa2 " ng-model="selectName"><span ng-show="isLabel && selectName.length != 0" ng-click="changeElement()">{{appendString}}{{selectName}}</span><ul class="complete-list" ng-show="isFocus"><li ng-repeat="item in itemList" ng-click="click($event, item)" >{{item[namePropertie]}}</li></ul><span class="input-group-addon question"><i class="fa fa-plus fa-2x" ng-click="clickI()"></i></span>',link:function(a,b){a.selectName="",a.isFocus=!1,a.isLabel=!1;var c=[];a.$watch("itemList",function(b,d){if(void 0!==b&&void 0!==d){if(b.length===d.length)return!1;b.length>d.length?c=angular.copy(b):b.length<d.length&&(c=angular.copy(d))}else void 0!==a.itemList&&angular.copy(a.itemList,c)}),b.find("input").on("focus",function(){0<a.itemList.length&&a.$apply(function(){a.isFocus=!0})}),b.find("input").on("blur",function(){var d=setInterval(function(){a.$apply(function(){if(a.selectByList){for(var d=c.length,e=0===a.selectName.length?!0:!1,f=0;d>f;f++)if(a.selectName===c[f][a.namePropertie]){e=!0;break}e?b.find("input").removeClass("auto-complete-item-error"):b.find("input").addClass("auto-complete-item-error"),a.isFocus=!1}}),clearInterval(d)},300)}),b.find("input").on("keyup",function(){0===c.length&&angular.copy(a.itemList,c);var b=[];if(0<a.itemList.length&&(a.isFocus=!0),0===a.selectName.length)angular.copy(c,b);else for(var d=c.length,e=0;d>e;e++)-1!==c[e][a.namePropertie].indexOf(a.selectName)&&b.push(angular.copy(c[e]));a.$apply(function(){angular.copy(b,a.itemList)})}),a.click=function(c,d){c.preventDefault(),c.stopPropagation(),angular.copy(d,a.selectedItem),b.find("input").removeClass("auto-complete-item-error"),a.isFocus=!1,void 0!==a.execute&&a.execute(),a.showLabel&&(a.isLabel=!0),a.selectName=d[a.namePropertie]},a.changeElement=function(){angular.copy(c,a.itemList),a.isLabel=!1,b.find("input").focus()},a.clickI=function(){angular.copy(c,a.itemList),a.isFocus=!1,a.clickExecute()}}}});