"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),AccessController=function(){function a(b,c,d,e,f,g){_classCallCheck(this,a),this._scope=b,this.$sce=c,this.$routeParams=d,this.Shared=e,this.Access=f,this.Utility=g,this.Shared.destloy("serchDay"),this.Shared.setRoot("accsess"),this.showDate="",this.serchDay="",this.logList=[],this.targetName="",this.showDate="",this.timelineList=[]}return _createClass(a,[{key:"initialize",value:function(){var a=this;this._scope._construct();var b=this.Utility.today("YYYY-MM-DD");this._scope.$emit("requestStart"),this.Access.resource.day({day:b}).$promise.then(function(b){a.logList=b.data,a._scope.$emit("requestEnd")})}},{key:"serchByDay",value:function(){var a=this;this.Utility.isDateValid(this.serchDay)&&this.Access.resource.day({day:this.serchDay}).$promise.then(function(b){a.logList=b.data,a.Shared.set("serchDay",a.serchDay)})}},{key:"getTimeInitializeData",value:function(){var a=this,b=this.Shared.get("serchDay");void 0===b&&(b=this.Utility.today("YYYY-MM-DD")),this.Access.resource.day({day:b,id:this.$routeParams.id}).$promise.then(function(c){a.targetName=c.data[0].name,a.showDate=b,a.timelineList=c.data})}},{key:"setPosition",value:function(a){return a%2==0}}]),a}();AccessController.$inject=["$scope","$sce","$routeParams","Shared","Access","Utility"],angular.module("accessCtrl",["AccessServices"]).controller("AccessCtrl",AccessController);var coreCtrl=angular.module("coreCtrl",[]);coreCtrl.controller("CoreCtrl",["$scope","Shared",function(a,b){a._construct=function(){a.isHeader=!0},a.$on("loginComplete",function(){a.isHeader=!0,a.userName=b.get("userName")}),a.$on("loginInit",function(){a.isHeader=!1}),a.$on("loginFailed",function(){a.isHeader=!1}),a.$on("logoutConplete",function(){a.isHeader=!1}),a.$on("requestStart",function(){a.isSpinner=!0}),a.$on("requestEnd",function(){a.isSpinner=!1})}]);var mainCtrl=angular.module("mainCtrl",["CustomerServices","AzureServices"]);mainCtrl.controller("MainCtrl",["$scope","Shared","Customer","Azure","Utility",function(a,b,c,d,e){function f(){a.customerList=[],a.approch=[],a.customer=[],a.rank="",a.selectedCustomer={},a.lineLabel="",a.addStyle="",a.legendLabel=[],a.isGetData=!1}a.initialize=function(){a._construct(),f(),c.resource.get().$promise.then(function(b){a.customerList=b.data})},a.custmoerChangeExecute=function(){a.$emit("requestStart"),c.resource.detail({id:a.selectedCustomer.Id}).$promise.then(function(b){a.customer=b.customer,a.approch=b.approch,a.rank=a.approch[0].name,a.addStyle="two-row";var c=e.diffMonth(b.customer.last_purchasing_date,b.customer.start_purchasing_date);a.customer.frequency_avg=Math.round(10*b.customer.frequency/c)/10,a.customer.monetary_avg=Math.round(b.customer.monetary/c),a.customer.last_purchasing_date=e.formatString(a.customer.last_purchasing_date,"YYYY年MM月DD日"),a.lineLabel="直近1年の売上推移（月別サマリ）",a.legendLabel=[a.selectedCustomer.customer_id,"ランク平均"],a.orders=[b.orders,b.orders_avg],a.$emit("requestEnd"),a.isGetData=!0})},a.recomender=function(){a.$emit("requestStart"),d.resource.recomender({id:a.selectedCustomer.Id}).$promise.then(function(b){if(a.$emit("requestEnd"),""===b.data)e.successSticky("おすすめ商品はありません");else{var c=b.data[0];delete c[0],e.successSticky(c.join())}})}}]);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),LoginController=function(){function a(b,c,d){_classCallCheck(this,a),this._scope=b,this._authService=c,this._locationService=d,this._scope.$emit("loginInit"),this.data={mailAddress:"",password:"",remember:!1}}return _createClass(a,[{key:"submit",value:function(){var a=this;this._scope.$emit("requestStart"),this._authService.login(this.data).then(function(){a._scope.$emit("requestEnd"),a._scope.$emit("loginComplete"),a._locationService.home()},function(){this._scope.$emit("requestEnd")})}}]),a}();LoginController.$inject=["$scope","Auth","Location"],angular.module("loginCtrl",["AuthServices"]).controller("LoginCtrl",LoginController);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),DashbordController=function(){function a(b,c,d,e,f){_classCallCheck(this,a),this._scope=b,this._sharedService=c,this._utilityService=d,this._scenarioService=e,this._modalService=f,this.scenario=[],this.scenarioList=[],this.isShowExecutePlanScenario=!1,this.executePlanScenario=[],this._getInitializeData()}return _createClass(a,[{key:"initialize",value:function(){}},{key:"_getInitializeData",value:function(){var a=this;this._scenarioService.resource.typeCount().$promise.then(function(b){a.scenarioList=b.data,a._scenarioService.resource.executeplan().$promise.then(function(b){a.isShowExecutePlanScenario=b.data.length>0,a.executePlanScenario=b.data})})}},{key:"bulkInvalid",value:function(){this._scope.modalParam={title:"シナリオの一括無効について",message:"実行予定のシナリオをすべて無効にしますがよろしいですか？<br>再度有効にする場合はアプローチ管理画面から有効にできます。",isExecute:!0,executeLabel:"一括で無効にする",execute:function(){this._scenarioService.resource.bulkInvalid().$promise.then(function(){this._scope.modalInstance.close(),this._utilityService.info("実行予定のシナリオを一括無効しました。"),this._scope.initialize()})}},this._scope.modalInstance=this._modalService.open(this._scope,"partials/modal/message.html")}}]),a}();DashbordController.$inject=["$scope","Shared","Scenario","Utility","Modal"],angular.module("dashbordCtrl",["ScenarioServices"]).controller("DashbordCtrl",DashbordController);var segmentCtrl=angular.module("segmentCtrl",["SegmentServices"]);segmentCtrl.controller("SegmentCtrl",["$scope","Shared","Segment","Utility",function(a,b,c,d){function e(){b.setRoot("segment"),a.segmentList=[]}a.initialize=function(){a._construct(),e(),c.resource.get().$promise.then(function(b){a.segmentList=b.data,a.showInfo=a.segmentList.length>0?!0:!1})},a.download=function(a){c.download(a)},a.remove=function(b){var e=a.segmentList[b];console.log(e),c.resource.remove({id:e.segment_id,segment_document_id:e.segment_document_id}).$promise.then(function(){d.info("削除しました"),a.segmentList.splice(b,1)})}}]);var segmentControlCtrl=angular.module("segmentControlCtrl",["SegmentServices","QueryServices"]);segmentControlCtrl.controller("SegmentControlCtrl",["$scope","$routeParams","Modal","Shared","Segment","Query","Utility","Location",function(a,b,c,d,e,f,g,h){function i(){a.pageTitle=e.pageProp(b.id).pageTitle,a.viewMode=e.pageProp(b.id).viewMode,a.segmenData={},a.queryList=[],a.conditions=[],a.segmentSearch="",a.segment={},a.isExecte=!1}a.initialize=function(){a._construct(),i(),d.setRoot("segment control"),f.resource.getQuery().$promise.then(function(c){2===e.pageProp(b.id).viewMode?e.resource.get({id:b.id}).$promise.then(function(d){a.segment.segment_id=b.id,a.segment.segment_name=d.segment_name,a.segment.segment_document_id=d.segment_document_id,e.setListData(c.data,d.qIds,a.conditions),a.queryList=c.data,e.setWhereProp(a.queryList),e.setWhereProp(a.conditions,d.whereList),a.isExecte=!0}):(a.queryList=c.data,e.setWhereProp(a.queryList))})},a.moveQuery=function(b){a.conditions.push(a.queryList[b]),a.queryList.splice(b,1),a.isExecte=!0},a.removeItem=function(b){a.queryList.push(a.conditions[b]),a.conditions.splice(b,1),0===a.conditions.length&&(a.isExecte=!1)},a.save=function(){var b=e.createDocData(a.conditions),c={segment_name:a.segment.segment_name,segment_document_id:a.segment.segment_document_id,whereList:b.whereList,qIds:b.qIds};e.resource.saveDoc({data:c}).$promise.then(function(b){var c={segment_id:a.segment.segment_id,segment_name:b.data.segment_name,segment_document_id:b.data.id};e.resource.save({data:c}).$promise.then(function(){g.info("セグメントを保存しました"),h.segment()})})},a.execute=function(){var b=e.createExecuteInfo(a.conditions);e.resource.executeQuery(b).$promise.then(function(a){g.info("該当データは"+a.result+"件あります")})}}]);var scenarioCtrl=angular.module("scenarioCtrl",["ScenarioServices"]);scenarioCtrl.controller("ScenarioCtrl",["$scope","$routeParams","Shared","Utility","Scenario",function(a,b,c,d,e){function f(){a.addPageTitle=e.getPageProp(b.scenario).title,a.type=b.scenario,a.scenarioList=[]}a.initialize=function(){c.setRoot("scenario"),a._construct(),f(),e.resource.get({type:b.scenario}).$promise.then(function(b){a.isScenarioShow=b.data.length>0?!0:!1,a.isScenarioShow&&(a.scenarioList=b.data)})},a.remove=function(c){if(void 0===c||isNaN(parseInt(c,10)))return!1;var f=a.scenarioList[c].scenario_id,g=a.scenarioList[c].scenario_name,h={type:b.scenario,id:f};e.resource.remove(h).$promise.then(function(){d.info(g+"<br>を削除しました。"),a.scenarioList.splice(c,1),a.isScenarioShow=a.scenarioList.length>0?!0:!1})}}]);var scenarioControlCtrl=angular.module("scenarioControlCtrl",["ScenarioServices","SegmentServices"]);scenarioControlCtrl.controller("ScenarioControlCtrl",["$scope","$routeParams","Modal","Shared","Utility","Location","Scenario",function(a,b,c,d,e,f,g){function h(){a.isBaseCollapse=!1,a.isOriginCollapse=!1,a.isShowExtraction=!1,a.pageTitle=o.title+o.addTitle,a.scenario={},a.scenario.approach,a.scenario.status,a.type=b.scenario,a.template=o.template,a.inputTag="",a.tagList=[],a.selectTagList=[],a.isTagCollapse=!1,d.setRoot(a.type+" scenario"),1===o.type?a.specificInfo={repeat_flag:null,expiration_start_date:e.today("YYYY-MM-DD"),expiration_end_date:"",interval:0,intervalCondition:"",daysCondition:g.daysCondition(),weekCondition:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1}}:2===o.type&&(a.conditions=[],a.specificInfo={},a.decisionList=[])}function i(){a.validators={segment:{isSelect:function b(){var c=a.segmentList||{},b=!1;return angular.forEach(c,function(a){a.isPush&&(b=!0)}),b}},ifLayout:{isSelect:function c(){var b=a.ifList||{},c=!1;return angular.forEach(b,function(a){a.isPush&&(c=!0)}),c}},expiration_start_date:{isDateValid:function(a,b){var c=a||b;return e.isDateValid(c)}},expiration_end_date:{isDateValid:function(a,b){var c=a||b;return e.isDateValid(c)},isAfter:function(b,c){var d=b||c;return e.isAfter(d,a.specificInfo.expiration_start_date)}},interval:{isSelect:function(a,b){var c=a||b;return 0!==c}},weekCondition:{isSelect:function d(){var b=a.specificInfo.weekCondition||{},d=!1;return angular.forEach(b,function(a){a&&(d=!0)}),d}},daysCondition:{isSelect:function f(){var b=a.specificInfo.daysCondition||{},f=!1;return angular.forEach(b,function(a){a.check&&(f=!0)}),f}}},a.asyncValidators={scenario_name:{same:function(a,b){var c=a||b;return void 0===c||0===c.length?!0:g.validators.isSameName({id:p,scenario_name:c})}},output_name:{same:function(a,b){var c=a||b;return void 0===c||0===c.length?!0:g.validators.isSameName({id:p,output_name:c})}}}}function j(){var c={type:b.scenario},d=void 0!==p;d&&(c.id=p),g.resource.initializeData(c).$promise.then(function(b){a.segmentList=b.segment,a.ifList=b.ifLayout,a.scenario=b.target,a.tagList=b.tagList,a.selectTagList=b.settinTags,1===o.type?d&&k(b):2===o.type&&(a.actionList=b.specific,d&&(a.activeId=b.specificInfo.doc.actionId,l(b)))})}function k(b){a.specificInfo.repeat_flag=b.specificInfo.specific.repeat_flag,a.specificInfo.expiration_start_date=e.formatString(b.specificInfo.specific.expiration_start_date),null!==b.specificInfo.specific.expiration_end_date&&(a.specificInfo.expiration_end_date=e.formatString(b.specificInfo.specific.expiration_end_date)),null!==b.specificInfo.doc&&(a.specificInfo.interval=b.specificInfo.doc.interval,2===a.specificInfo.interval?a.specificInfo.weekCondition=b.specificInfo.doc.weekCondition:3===a.specificInfo.interval&&(a.specificInfo.daysCondition=b.specificInfo.doc.daysCondition))}function l(b){a.specificInfo=b.specificInfo.specific,q=b.specificInfo.doc.actionId,a.isShowExtraction=!0;for(var c=b.specific.length,d=0;c>d;d++)if(q===b.specific[d].id){a.columnList=b.specific[d].column;break}angular.forEach(b.specificInfo.doc.conditionList,function(b){var c=[];angular.forEach(b,function(b){angular.forEach(a.columnList,function(a){b.physicalname==a.physicalname&&(a.condition=b.condition,a.selectedCondition=b.selectedCondition,c.push(a))})}),r.push(c);var d=g.createCondtionString(c);a.decisionList.push(d)})}function m(){a.$watch("scenario.scenario_name",function(){a.scenarioForm.scenario_name.$validate()}),a.$watch("scenario.output_name",function(){a.scenarioForm.output_name.$validate()}),a.$watch("segmentList",function(){a.scenarioForm.segment.$validate()},!0),a.$watch("ifList",function(){a.scenarioForm.ifLayout.$validate()},!0),1===o.type&&(null!==a.specificInfo.repeat_flag&&a.$watch("specificInfo.expiration_start_date",function(){a.scenarioForm.expiration_start_date.$validate()}),1===a.specificInfo.repeat_flag&&(a.$watch("specificInfo.expiration_end_date",function(){a.scenarioForm.expiration_end_date.$validate()}),a.$watch("specificInfo.interval",function(){a.scenarioForm.interval.$validate()})))}function n(){}var o=g.getPageProp(b.scenario,b.id),p=b.id,q=0,r=[];a.initialize=function(){a._construct(),h(),j(),i(),m(),n()},a.showAction=function(b,c){a.conditions=[],a.decisionList=[],q==b?a.isShowExtraction=!a.isShowExtraction:(a.isShowExtraction=!0,a.columnList=c,q=b)},a.addTag=function(){if(!(0>=a.inputTag.length)){var b=!0;angular.forEach(a.selectTagList,function(c){return a.inputTag===c.tag_name?(b=!1,!1):void 0}),b&&(a.selectTagList.push({tag_name:a.inputTag}),a.inputTag="")}},a.removeTag=function(b){a.selectTagList.splice(b,1)},a.moveCondition=function(b){var c={};angular.copy(b,c),a.conditions.push(c)},a.removeItem=function(b){a.conditions.splice(b,1)},a.decision=function(){var b=!0;if(angular.forEach(a.conditions,function(a){return a.error||""===a.condition.value1||void 0===a.condition.value1?(b=!1,!1):void 0}),b){r.push(a.conditions);var c=g.createCondtionString(a.conditions);a.decisionList.push(c),a.conditions=[]}},a.removeDecisionList=function(b){r.splice(b,1),a.decisionList.splice(b,1)},a.clear=function(){h(),j()},a.save=function(){var b,c;if(1===o.type)c={repeat_flag:a.specificInfo.repeat_flag,expiration_start_date:a.specificInfo.expiration_start_date,expiration_end_date:a.specificInfo.expiration_end_date},1==a.specificInfo.repeat_flag&&(b={interval:a.specificInfo.interval},2===a.specificInfo.interval?b.weekCondition=a.specificInfo.weekCondition:3===a.specificInfo.interval&&(b.daysCondition=a.specificInfo.daysCondition));else{if(2!==o.type)return!1;if(0===r.length)return!1;b={actionId:q,conditionList:g.getConditionDoc(r)},c=a.specificInfo}a.scenario.scenario_type=o.type,g.setActivePushItem(a.segmentList,"segment_id",a.scenario,"segment_id"),g.setActivePushItem(a.ifList,"id",a.scenario,"if_layout_id");var d={scenario:a.scenario,specificInfo:c,doc:b,tags:a.selectTagList};g.resource.save(d).$promise.then(function(){e.info("シナリオを保存しました。"),1===o.type?f.schedule():2===o.type&&f.trigger()})},a.weekConditionValidation=function(){a.scenarioForm.weekCondition.$validate()},a.daysConditionValidation=function(){a.scenarioForm.daysCondition.$validate()}}]);var queryListCtrl=angular.module("queryListCtrl",["QueryServices"]);queryListCtrl.controller("QueryListCtrl",["$scope","Shared","Query","Segment","Modal","Location","Utility",function(a,b,c,d,e,f,g){function h(){a.queryList=[],b.setRoot("query list")}a.initialize=function(){a._construct(),h(),c.resource.getList().$promise.then(function(b){a.queryList=b.data,a.isQueryShow=a.queryList.length>0})},a.showSegment=function(b){if(void 0!==a.queryList[b].id){var c=a.queryList[b],g={qId:c.id,count:c.useNum};d.resource.useSegment(g).$promise.then(function(c){a.modalParam={title:a.queryList[b].query_name+"を利用しているセグメント",list:c.data,hrefBase:"#/segment/control",dynamicParamKey:"id",close:function(b){a.modalInstance.close(),f.segmentControl(b)}},a.modalInstance=e.open(a,"partials/modal/list.html")})}},a.deleteItem=function(b){if(void 0!==a.queryList[b]){var d=a.queryList[b].query_name;c.resource.remove({id:a.queryList[b].id}).$promise.then(function(){g.info(d+"<br>を削除しました。"),a.queryList.splice(b,1)})}}}]);var queryCtrl=angular.module("queryCtrl",["QueryServices"]);queryCtrl.controller("QueryCtrl",["$scope","$routeParams","Shared","Query","Location","Utility",function(a,b,c,d,e,f){function g(b){c.destloyByName("queryName"),c.destloyByName("updateQueryDocumentId"),a.tableList=[],a.tableListRef=[],a.columnNum=0,a.selectColumns=[],b||(a.selectColumns=c.get("queryColumns")||[]),a.showSelectedColumnsBox=a.selectColumns.length>0,a.conditions=[],a.isShowEditMessage=!1,a.returnUrl=d.getReturnURL(),c.setRoot("query")}function h(b){angular.forEach(b.tables,function(b,c){angular.forEach(b,function(b){angular.forEach(a.tableList[c].column,function(d){return b.column===d.physicalname?(a.selectColumns.push({table:{logicalname:a.tableList[c].logicalname,physicalname:a.tableList[c].physicalname},column:d,selectedCondition:{name:"",value:b.conditionType,symbol:""},condition:b.values}),!1):void 0})})}),a.showSelectedColumnsBox=a.selectColumns.length>0,c.set("queryColumns",a.selectColumns)}function i(){a.docIdUrl="";var b=c.get("updateQueryDocumentId");void 0!==b&&(a.docIdUrl="/control/"+b,a.isShowEditMessage=!0,a.queryName=c.get("updateQueryName"))}function j(){a.$on("dropItemComplete",function(b){b.stopPropagation(),angular.forEach(a.showConditions,function(a){console.log(a.length),1===a.length&&(a.isJoin=!1)})})}var k="";a.initialize=function(){var e=b.hasOwnProperty("id");a._construct(),g(e),e?d.resource.getControlInit({id:b.id}).$promise.then(function(e){a.queryName=e.data.query_name,a.tableList=e.table,a.tableListRef=d.getRefTabels(e.table),0===a.selectColumns.length&&h(e.data),a.isShowEditMessage=!0,c.set("updateQueryDocumentId",b.id),c.set("updateQueryName",e.data.query_name)}):d.resource.get().$promise.then(function(b){a.tableList=b.table,a.tableListRef=d.getRefTabels(b.table)})},a.showColumns=function(b){k=b,a.columnList=a.tableList[b].column,a.columnNum=a.columnList.length},a.setColumn=function(b){var d=a.tableList[k],e=!1;angular.forEach(a.selectColumns,function(a){a.table.physicalname===k&&a.column.physicalname===d.column[b].physicalname&&(e=!0)}),e||a.selectColumns.push({table:{logicalname:d.logicalname,physicalname:d.physicalname},column:d.column[b]}),a.showSelectedColumnsBox=!0,c.set("queryColumns",a.selectColumns)},a.removeColumn=function(b){a.selectColumns.splice(b,1),a.showSelectedColumnsBox=a.selectColumns.length>0,c.set("queryColumns",a.selectColumns)},a.nextValidation=function(){c.setRoot("query set"),a.selectColumns=c.get("queryColumns"),void 0===a.selectColumns&&e.query(),angular.forEach(a.selectColumns,function(){}),i()},a.removeItem=function(b){a.selectColumns.splice(b,1),0===a.selectColumns.length&&e.query()},a.next=function(){var b=!1;angular.forEach(a.selectColumns,function(a){return a.error?!1:void(b=!0)}),b&&e.querySave()},a.saveInitialize=function(){c.setRoot("query save"),j(),i(),a.query={query_name:c.get("updateQueryName")},a.conditions=[];var b=c.get("queryColumns");void 0===b&&e.query(),a.selectColumns=[],d.createCondtionString(b),a.showConditions=[],angular.forEach(b,function(b){var c=[];c.push(b),c.isJoin=!1,a.showConditions.push(c)})},a.isJoin=function(a){return a.isJoin},a.release=function(b,c){var d=[];d.push(a.showConditions[b][c]),console.log("削除前："+a.showConditions.length),a.showConditions[b].splice(c,1),console.log("削除後："+a.showConditions.length),console.log(a.showConditions),1===a.showConditions[b].length&&(a.showConditions[b].isJoin=!1),a.showConditions.push(b,0,d),console.log("ぷっしゅ後："+a.showConditions.length),console.log(a.showConditions)},a.save=function(){var b=c.get("queryColumns"),g=d.getTables(b),h={query_document_id:c.get("updateQueryDocumentId"),query_name:a.query.query_name,conditionList:a.showConditions,tables:g};d.resource.create(h).$promise.then(function(){c.destloyByName("queryColumns"),c.destloyByName("updateQueryName"),c.destloyByName("updateQueryDocumentId"),f.info("クエリを保存しました"),e.query()})},a.execute=function(){var b=c.get("queryColumns"),e=d.getTables(b),g={tables:e,conditionList:a.showConditions};d.resource.executeQuery(g).$promise.then(function(a){f.info("該当データは"+a.result+"件あります")})}}]);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),ApproachController=function(){function a(b,c,d,e,f,g){_classCallCheck(this,a),this._scope=b,this._sharedService=c,this._utilityService=d,this._approachService=e,this._scenarioService=f,this._modalService=g,this._scope._construct(),this._sharedService.setRoot("approach"),this._clear()}return _createClass(a,[{key:"initialize",value:function(){this._clear(),this._getInitializeData()}},{key:"_clear",value:function(){this.approachData=[],this.scenarioList=[],this.showScenarioList=!1}},{key:"_getInitializeData",value:function(){var a=this;this._approachService.resource.get().$promise.then(function(b){a.approachData=b.data,a._scenarioService.resource.valid().$promise.then(function(b){a.scenarioList=b.data,a.showScenarioList=0<a.scenarioList.length})})}},{key:"_setEventListeners",value:function(){this._scope.$on("dropItemComplete",function(a,b){this.scenarioList=b.to,this._scope.$apply()})}},{key:"save",value:function(){var a=this;this._approachService.resource.save(this.approachData).$promise.then(function(){a._utilityService.info("設定を更新しました")})}},{key:"savePriority",value:function(){var a=this;this._scenarioService.resource.priority({data:this.scenarioList}).$promise.then(function(){a._utilityService.info("優先順位を更新しました")})}},{key:"showDiscription",value:function(a){var b=this._approachService.getInfomation(a);this._scope.modalParam={title:b.title,message:b.message,isExecute:!1},this._scope.modalInstance=this._modalService.open(this._scope,"partials/modal/message.html")}},{key:"bulkInvalid",value:function(){var a={title:"シナリオの一括無効について",text:"有効なシナリオをすべて無効にしますがよろしいですか？<br>実行した場合、実行予定シナリオはなくなります。",confirmButtonText:"一括で無効にする",execute:function(){var a=this;this._scenarioService.resource.bulkInvalid().$promise.then(function(){a._utilityService.info("アプローチ対象シナリオをすべて無効しました。"),a.initialize()})}};this._utilityService.infoAlert(a)}},{key:"bulkEnable",value:function(){var a={title:"シナリオの一括有効について",text:"無効なシナリオをすべて有効にしますがよろしいですか？<br>実行した場合、実行予定シナリオとしてダッシュボード画面に表示されます。",isExecute:!0,confirmButtonText:"一括で有効にする",execute:function(){var a=this;this._scenarioService.resource.bulkEnable().$promise.then(function(){a._utilityService.info("アプローチ対象シナリオをすべて有効しました。"),a.initialize()})}};this._utilityService.infoAlert(a)}}]),a}();ApproachController.$inject=["$scope","Shared","Utility","Approach","Scenario","Modal"],angular.module("approachCtrl",["ApproachServices","ScenarioServices"]).controller("ApproachCtrl",ApproachController);var userCtrl=angular.module("userCtrl",["UesrServices"]);userCtrl.controller("UserCtrl",["$scope","$routeParams","Shared","User","Utility",function(a,b,c,d,e){function f(){a.userList=[]}a.initialize=function(){c.setRoot("user"),a._construct(),f(),d.resource.get().$promise.then(function(b){a.userList=b.data})},a.remove=function(b){d.resource["delete"]({id:b}).$promise.then(function(){angular.forEach(a.userList,function(c,d){c.user_id===b&&a.userList.splice(d,1)}),e.successSticky("ユーザーを削除しました")})}}]);var userControlCtrl=angular.module("userControlCtrl",["UesrServices","RoleServices"]);userControlCtrl.controller("UserControlCtrl",["$scope","$routeParams","User","Role","Utility","Shared","Location",function(a,b,c,d,e,f,g){function h(){if(a.user={},a.pageTitle=k.title,a.showPassword=!0,a.passwordEdit={show:"1"},a.pageType=k.type,2===k.type){a.passwordEdit.show="0",a.showPassword=!1;var d=parseInt(b.id,10);c.resource.get({id:d}).$promise.then(function(b){a.user=b.data[0],a.user.password_confirm=a.user.password})}}function i(){a.validators={password:{same:function(b,c){var d=b||c,e=a.user||{};return d!=e.name}},password_confirm:{confirm:function(b,c){var d=a.user||{},e=b||c;return e==d.password}},selected_role:{role:function(){var b=a.roleList||{},c=!1;return angular.forEach(b,function(a){a.isPush&&(c=!0)}),c}}},a.asyncValidators={mailaddress:{same:function(b,d){var e=b||d;return void 0===e||0===e.length?!0:c.validators.isSameMailAddress(a.user.user_id,e)}}}}function j(b){angular.forEach(b,function(b){b.isPush&&(a.user.role_id=b.role_id)})}var k=c.getPageProp(b.id);a.initialize=function(){f.setRoot("user control"),a._construct(),h(),i(),d.resource.get().$promise.then(function(b){a.roleList=b.data}),1===a.passwordEdit&&(a.$watch("user.name",function(){a.userForm.password.$validate()}),a.$watch("user.password",function(){a.userForm.password_confirm.$validate()})),a.$watch("roleList",function(){a.userForm.selected_role.$validate()},!0)},a.save=function(){j(a.roleList);var b=a.user.name+"さんの情報を保存しました";2===k.type?(e.deleteCommonInfo(a.user),"1"!==a.passwordEdit.show&&(delete a.user.password_confirm,delete a.user.password),c.resource.save({id:a.user.user_id,data:a.user}).$promise.then(function(){e.successSticky(b),g.user()})):c.resource.create({data:a.user}).$promise.then(function(){e.successSticky(b),g.user()})},a.isSameMailAddress=function(){a.userForm.mailaddress.$validate()}}]);var bugCtrl=angular.module("bugCtrl",["BugServices"]);bugCtrl.controller("BugCtrl",["$rootScope","$scope","$sce","Upload","Shared","Bug","Modal","Utility",function(a,b,c,d,e,f,g,h){function i(){b.bug={resolve:0,type:null}}function j(){k()}function k(){f.resource.getByConditon(b.bug).$promise.then(function(a){b.isBugShow=a.data.length>0,b.isBugShow&&(f.addViewInfo(a.data),b.bugList=a.data,b.roleId=a.role)})}function l(a){b.selectedFile.push(a[0])}function m(){if(0!==b.modalParam.newComment.length){var c={demand_bug_id:b.modalParam.id,comment:b.modalParam.newComment};null!==b.modalParam.files?(a.$broadcast("requestStart"),f.commentSaveAndUpload(b.modalParam.files,c,function(c){b.modalInstance.close(),null!==c&&h.error(c),k(),a.$broadcast("requestEnd")})):f.resource.saveComment(c).$promise.then(function(){b.modalInstance.close(),k()})}}b.selectedFile=[],b.initialize=function(){b._construct(),i(),j()},b.show=function(){b.modalParam={type:"",title:"",contents:"",category:"",categoryList:f.categoryList,files:null},b.modalInstance=g.open(b,"partials/modal/send.html")},b.apology=function(){h.info("障害ですか。。。<br>すみません！")},b.getByCondition=function(){k()},b.resolve=function(a){var c=b.bugList[a].title;f.resource.resolve({id:b.bugList[a].id}).$promise.then(function(){h.info(c+"<br>を解決しました。"),b.bugList[a].resolve_name="解決",k()})},b.save=function(){var c={type:b.modalParam.type,title:b.modalParam.title,contents:b.modalParam.contents,category:b.modalParam.category.type};null!==b.modalParam.files?(a.$broadcast("requestStart"),f.saveAndUpload(b.modalParam.files,c,function(c){b.modalInstance.close(),null!==c&&h.error(c),k(),a.$broadcast("requestEnd")})):f.resource.save(c).$promise.then(function(){h.info("ありがとございました。"),b.modalInstance.close(),k()})},b.showComment=function(a){b.modalParam={execute:m,onFileSelect:l,files:null,newComment:"",id:b.bugList[a].id},b.modalInstance=g.open(b,"partials/modal/comment.html")},b.showCommentView=function(a){f.resource.getComment({id:b.bugList[a].id}).$promise.then(function(c){b.bugList[a].comments=c.data})},b.vote=function(a){f.resource.vote({id:b.bugList[a].id}).$promise.then(function(){k()})},b.download=function(a){return null===a||void 0===a?!1:void f.resource.download({id:a}).$promise.then(function(){b.modalInstance.close(),k()})}}]);